\section{APKey}

donc on decompile l'apk.

donc on a à faire à un login form.

\begin{verbatim}
 public void onClick(View view) {
            Toast makeText;
            String str;
            try {
                if (MainActivity.this.f928c.getText().toString().equals("admin")) {
                    MainActivity mainActivity = MainActivity.this;
                    b bVar = mainActivity.e;
                    String obj = mainActivity.d.getText().toString();
                    try {
                        MessageDigest messageDigest = MessageDigest.getInstance("MD5");
                        messageDigest.update(obj.getBytes());
                        byte[] digest = messageDigest.digest();
                        StringBuffer stringBuffer = new StringBuffer();
                        for (byte b2 : digest) {
                            stringBuffer.append(Integer.toHexString(b2 & 255));
                        }
                        str = stringBuffer.toString();
                    } catch (NoSuchAlgorithmException e) {
                        e.printStackTrace();
                        str = "";
                    }
                    if (str.equals("a2a3d412e92d896134d9c9126d756f")) {
                        Context applicationContext = MainActivity.this.getApplicationContext();
                        MainActivity mainActivity2 = MainActivity.this;
                        b bVar2 = mainActivity2.e;
                        g gVar = mainActivity2.f;
                        makeText = Toast.makeText(applicationContext, b.a(g.a()), 1);
                        makeText.show();
                    }
                }
                makeText = Toast.makeText(MainActivity.this.getApplicationContext(), "Wrong Credentials!", 0);
                makeText.show();
            } catch (Exception e2) {
                e2.printStackTrace();
            }
        }
    }
\end{verbatim}

on confronte le password à un \verb+MD5+

en cherchant sur internet on trouve 98 comme valeur mais pas trop fiable. Donc
on va modifier le smali et recompiler

\begin{verbatim}
    :cond_1
    iget-object p1, p0, Lcom/example/apkey/MainActivity$a;->b:Lcom/example/apkey/MainActivity;

    invoke-virtual {p1}, Landroid/app/Activity;->getApplicationContext()Landroid/content/Context;

    move-result-object p1

    const-string v1, "Wrong Credentials!"
\end{verbatim}

en remontant on a
\begin{verbatim}
if-eqz p1, :cond_1
\end{verbatim}

en remontant encore on a:
\begin{verbatim}
 .line 2
    invoke-virtual {p1, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z

    move-result p1
\end{verbatim}
et encore avant on a 
\begin{verbatim}
const-string v1, "a2a3d412e92d896134d9c9126d756f"
\end{verbatim}

donc si \verb+p1+ est égal à 0 c'est une erreur.


si on set p1 à la même valeur que v1 avant le test
\begin{verbatim}
:goto_1
    const-string v1, "a2a3d412e92d896134d9c9126d756f"

    .line 2
    invoke-virtual {p1, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
\end{verbatim}

devient
\begin{verbatim}
:goto_1
    const-string v1, "a2a3d412e92d896134d9c9126d756f"
    const-string p1, "a2a3d412e92d896134d9c9126d756f"
    .line 2
    invoke-virtual {p1, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
\end{verbatim}

on recompile
\begin{verbatim}
$ apktool b APKey -o unisgned.apk
I: Using Apktool 2.5.0-dirty
I: Checking whether sources has changed...
I: Checking whether resources has changed...
I: Building apk file...
I: Copying unknown files/dir...
I: Built apk...
\end{verbatim}

retourne un erreur de signature à l'install

\begin{verbatim}
 keytool -genkey -v -keystore key.jks -keyalg RSA -keysize 2048 -validity 10000 -alias jubeaz

  jarsigner -keystore key.jks unisgned.apk jubeaz
Enter Passphrase for keystore:
jar signed.

Warning:
The signer's certificate is self-signed.
\end{verbatim}


bingo!
\begin{verbatim}
HTB{}m0r3_Obfusc4t1on_w0uld_n0t_hurt}
\end{verbatim}
